<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Band Management Tool</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Organisiere deine Bandproben effizient">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Band Planning">

    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons (optional, remove if not yet created) -->
    <!-- <link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192.png"> -->
    <!-- <link rel="icon" type="image/png" sizes="512x512" href="/images/icon-512.png"> -->
    <!-- <link rel="apple-touch-icon" href="/images/icon-192.png"> -->

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css?v=1769686133">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/calendar.css">
    <!-- <link rel="stylesheet" href="css/loader.css"> Removed: Consolidated into style.css -->
    <link rel="stylesheet" href="css/settings_modal.css">
    <link rel="stylesheet" href="css/statistics.css">

    <!-- Supabase JS (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- html2canvas for rendering DOM to canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Make jsPDF available as global variable from UMD module
        if (window.jspdf) {
            window.jsPDF = window.jspdf.jsPDF;
        }
    </script>
</head>

<body>
    <!-- Toast Notification (must be directly under body for proper z-index) -->
    <div id="toast" class="toast"></div>

    <!-- Global Loading Overlay -->
    <div class="loader-container" id="globalLoadingOverlay">
        <span class="guitar-spinner">&#127928;</span>
    </div>
    <script>
        // Show loading overlay on first load, hide when app is ready
        window.addEventListener('DOMContentLoaded', function () {
            function hideOverlay() {
                const overlay = document.getElementById('globalLoadingOverlay');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.style.display = 'none', 400);
                }
            }
            // Hide overlay as soon as main app or landing page is visible
            function checkAppReady() {
                const app = document.getElementById('mainApp');
                const landing = document.getElementById('landingPage');
                if ((app && app.style.display !== 'none') || (landing && landing.classList.contains('active'))) {
                    hideOverlay();
                    return true;
                }
                return false;
            }
            // Observe DOM changes to detect when app is shown
            const observer = new MutationObserver(() => {
                if (checkAppReady()) observer.disconnect();
            });
            observer.observe(document.body, { subtree: true, attributes: true, attributeFilter: ['style', 'class'] });
            // Fallback: hide after 3s if not already hidden
            setTimeout(hideOverlay, 3000);
        });
        // Ensure loading overlay stays visible for at least one animation cycle
        (function () {
            const overlay = document.getElementById('globalLoadingOverlay');
            if (!overlay) return;
            let minTime = 2000; // 2s = one animation cycle
            let hideRequested = false;
            let shownAt = Date.now();
            // Patch hide logic if present
            window.hideGlobalLoadingOverlay = function () {
                let elapsed = Date.now() - shownAt;
                if (elapsed >= minTime) {
                    overlay.style.display = 'none';
                } else {
                    hideRequested = true;
                    setTimeout(() => {
                        if (hideRequested) overlay.style.display = 'none';
                    }, minTime - elapsed);
                }
            };
            // Patch show logic if present
            window.showGlobalLoadingOverlay = function () {
                overlay.style.display = 'flex';
                shownAt = Date.now();
                hideRequested = false;
            };
        })();
    </script>
    <!-- EXACT REFERENCE DESIGN -->
    <div id="landingPage" class="landing-page active">
        <header class="landing-header">
            <div class="landing-logo">
                <img src="images/logo-planning.png" alt="Band Planning" style="height: 50px; width: auto;">
                <span>BAND PLANNING</span>
            </div>
            <nav class="landing-nav">
                <!-- Buttons removed per user request -->
            </nav>
        </header>

        <main class="landing-main">
            <h1 class="hero-welcome">Welcome</h1>
            <p class="hero-sub">
                Organisiere deine Proben, verwalte Auftritte und bleib mit deinem Team in Verbindung.
                Alles an einem Ort.
            </p>
            <div class="landing-buttons"
                style="margin-top: 2rem; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                <button class="btn-ref-learn" onclick="UI.toggleAuthOverlay(true, 'login')">Login</button>
                <button class="btn-ref-outline" onclick="UI.toggleAuthOverlay(true, 'register')">Registrieren</button>
            </div>
        </main>

        <!-- Auth Overlay (White Card Reference) -->
        <div id="authOverlay" class="landing-auth-overlay">
            <div class="auth-white-card">
                <div style="position: absolute; top: 1.5rem; right: 1.5rem; z-index: 10;">
                    <button onclick="UI.toggleAuthOverlay(false)"
                        style="background:none; border:none; color:#999; cursor:pointer; font-size: 1.5rem;">&times;</button>
                </div>

                <!-- No Tabs anymore -->

                <!-- Login Form -->
                <form id="loginForm" class="auth-form active">
                    <h2 style="margin-bottom: 2rem; color: #333; font-size: 1.8rem; font-weight: 800;">Willkommen zurÃ¼ck
                    </h2>
                    <div class="form-group">
                        <label for="loginUsername">Benutzername oder E-Mail</label>
                        <input type="text" id="loginUsername" placeholder="dein@name.de" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Passwort</label>
                        <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; font-size: 0.85rem;">
                        <label
                            style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: #666; font-weight: 400;">
                            <input type="checkbox" id="loginRememberMe" style="width: auto; margin: 0;"> Angemeldet
                            bleiben
                        </label>
                        <button type="button" class="btn-link"
                            style="color: #8b5cf6; text-decoration: none; font-weight: 500; background: none; border: none; padding: 0; cursor: pointer;"
                            onclick="UI.openModal('forgotPasswordModal')">Passwort vergessen?</button>
                    </div>
                    <button type="submit" class="btn-submit">Anmelden</button>
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <a href="privacy.html" target="_blank"
                            style="color: #999; font-size: 0.8rem; text-decoration: none;">DatenschutzerklÃ¤rung</a>
                    </div>
                    <div
                        style="text-align: center; margin-top: 1.5rem; border-top: 1px solid #eee; padding-top: 1.5rem;">
                        <span style="color: #666; font-size: 0.9rem;">Noch keinen Account? </span>
                        <a href="#" onclick="UI.switchAuthTab('register'); return false;"
                            style="color: #8b5cf6; font-weight: 600; text-decoration: none;">Jetzt registrieren</a>
                    </div>
                </form>

                <!-- Register Form -->
                <form id="registerForm" class="auth-form"
                    style="max-height: 60vh; overflow-y: auto; padding-right: 5px;">
                    <h2 style="margin-bottom: 2rem; color: #333; font-size: 1.8rem; font-weight: 800;">Account erstellen
                    </h2>
                    <!-- Code First (as requested) -->
                    <div class="form-group">
                        <label for="registerCode">Registrierungscode</label>
                        <input type="text" id="registerCode" placeholder="Code eingeben" required>
                    </div>

                    <!-- Row 1: Names -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="registerFirstName">Vorname</label>
                            <input type="text" id="registerFirstName" placeholder="Max" required>
                        </div>
                        <div class="form-group">
                            <label for="registerLastName">Nachname</label>
                            <input type="text" id="registerLastName" placeholder="Mustermann" required>
                        </div>
                    </div>

                    <!-- Row 2: User Details -->
                    <div class="form-group">
                        <label for="registerUsername">Benutzername</label>
                        <input type="text" id="registerUsername" placeholder="max.music" required>
                    </div>

                    <div class="form-group">
                        <label for="registerInstrument">Haupt-Instrument</label>
                        <select id="registerInstrument"
                            style="width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.03); border: 1px solid #ddd; border-radius: 6px;">
                            <option value="">Kein Instrument</option>
                            <option value="Vocals">ğŸ¤ Gesang</option>
                            <option value="Guitar">ğŸ¸ Gitarre</option>
                            <option value="Bass">ğŸ¸ Bass</option>
                            <option value="Drums">ğŸ¥ Drums</option>
                            <option value="Keys">ğŸ¹ Keys / Piano</option>
                            <option value="Brass">ğŸ· BlÃ¤ser</option>
                            <option value="Strings">ğŸ» Streicher</option>
                        </select>
                    </div>


                    <div class="form-group">
                        <label for="registerEmail">E-Mail</label>
                        <input type="email" id="registerEmail" placeholder="max@mustermann.de" required>
                    </div>

                    <!-- Row 3: Passwords -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="registerPassword">Passwort</label>
                            <input type="password" id="registerPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPasswordConfirm">BestÃ¤tigen</label>
                            <input type="password" id="registerPasswordConfirm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="registerProfileImage" style="cursor: pointer;">Profilbild (Optional)</label>
                        <input type="file" id="registerProfileImage" accept="image/*" style="font-size: 0.8rem;">
                    </div>

                    <button type="submit" class="btn-submit">Kostenlos Registrieren</button>

                    <div
                        style="text-align: center; margin-top: 1.5rem; border-top: 1px solid #eee; padding-top: 1.5rem;">
                        <span style="color: #666; font-size: 0.9rem;">Bereits registriert? </span>
                        <a href="#" onclick="UI.switchAuthTab('login'); return false;"
                            style="color: #8b5cf6; font-weight: 600; text-decoration: none;">Zum Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal (Inline style hidden) -->
    <div id="forgotPasswordModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Passwort vergessen</h2>
                <button class="modal-close" onclick="UI.closeModal('forgotPasswordModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; color: var(--color-text-secondary);">
                    Gib deinen Benutzernamen oder deine E-Mail-Adresse ein. Wir senden dir einen Link
                    zum ZurÃ¼cksetzen deines Passworts.
                </p>
                <form id="forgotPasswordForm">
                    <div class="form-group">
                        <label for="forgotIdentifier">Benutzername oder E-Mail</label>
                        <input type="text" id="forgotIdentifier" required placeholder="z.B. max.mustermann">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Link
                        anfordern</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Neues Passwort setzen</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; color: var(--color-text-secondary);">
                    Bitte gib dein neues Passwort ein.
                </p>
                <form id="resetPasswordForm">
                    <div class="form-group">
                        <label for="newPassword">Neues Passwort</label>
                        <input type="password" id="newPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="newPasswordConfirm">Passwort bestÃ¤tigen</label>
                        <input type="password" id="newPasswordConfirm" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Passwort
                        speichern</button>
                </form>
            </div>
        </div>
    </div>
    <!-- Privacy link removed from here to separate footer or specific modal location -->

    <!-- Main Dashboard (hidden initially) -->
    <div id="mainApp" class="main-app" style="display: none;">

        <!-- Onboarding Modal -->
        <div id="onboardingModal" class="modal">
            <div class="modal-content modal-large onboarding-container">
                <div class="onboarding-header">
                    <h1>Willkommen an Bord! ğŸ¸</h1>
                    <p class="subtitle">SchÃ¶n, dass du da bist! Wie mÃ¶chtest du starten?</p>
                </div>

                <div class="onboarding-cards">
                    <div class="onboarding-card" id="onboardingCreateBandCard">
                        <div class="card-icon">ğŸ—ï¸</div>
                        <h3>Band grÃ¼nden</h3>
                        <p>Werde zum Bandleiter und lade deine Mitmusiker ein.</p>
                        <button id="onboardingCreateBandBtn" class="btn btn-primary">Starten</button>
                    </div>

                    <div class="onboarding-card" id="onboardingJoinBandCard">
                        <div class="card-icon">ğŸ‘‹</div>
                        <h3>Band beitreten</h3>
                        <p>Nutze einen Code, um einer bestehenden Band beizutreten.</p>
                        <button id="onboardingJoinBandBtn" class="btn btn-secondary">Beitreten</button>
                    </div>

                    <div class="onboarding-card" id="onboardingSkipCard">
                        <div class="card-icon">ğŸ‘€</div>
                        <h3>Nur umschauen</h3>
                        <p>Wirf erst mal einen Blick auf die Funktionen im Dashboard.</p>
                        <button id="onboardingSkipBtn" class="btn btn-text">SpÃ¤ter</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="app" class="app-container" style="display: none;">

            <!-- Purple Sidebar (Desktop only) -->
            <aside class="app-sidebar">
                <!-- Sidebar Branding -->
                <div class="sidebar-brand" style="padding: var(--spacing-xl); text-align: center; color: white;">
                    <div style="font-size: 2.5rem; margin-bottom: var(--spacing-xs);">ğŸ¸</div>
                    <div style="font-weight: 800; font-size: 1.25rem; line-height: 1.2;">
                        <div>Band</div>
                        <div style="color: rgba(255,255,255,0.7);">Manager</div>
                    </div>
                </div>

                <!-- Profile Section Removed (now in Header) -->

                <!-- Navigation -->
                <!-- Navigation -->
                <nav class="sidebar-nav">
                    <!-- 1. ÃœBERBLICK -->
                    <div class="sidebar-group">
                        <button class="sidebar-item sidebar-main active" data-view="dashboard">
                            <span class="sidebar-icon">ğŸ </span>
                            <span class="sidebar-label">Ãœberblick</span>
                        </button>
                    </div>

                    <!-- 2. BANDS -->
                    <div class="sidebar-group has-submenu">
                        <button class="sidebar-item sidebar-main">
                            <span class="sidebar-icon">ğŸ‘¥</span>
                            <span class="sidebar-label">Bands</span>
                            <span class="submenu-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-submenu">
                            <button class="sidebar-subitem" data-view="bands">
                                <span class="sidebar-icon">ğŸ¸</span>
                                <span class="sidebar-label">Meine Bands</span>
                            </button>
                            <button class="sidebar-subitem" data-view="musikpool">
                                <span class="sidebar-icon">ğŸµ</span>
                                <span class="sidebar-label">Musikerpool</span>
                            </button>
                        </div>
                    </div>

                    <!-- 3. PLANUNG -->
                    <div class="sidebar-group has-submenu">
                        <button class="sidebar-item sidebar-main">
                            <span class="sidebar-icon">ğŸ—“ï¸</span>
                            <span class="sidebar-label">Planung</span>
                            <span class="submenu-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-submenu">
                            <button class="sidebar-subitem" data-view="rehearsals">
                                <span class="sidebar-icon">ğŸ“…</span>
                                <span class="sidebar-label">Probetermine</span>
                            </button>
                            <button class="sidebar-subitem" data-view="kalender">
                                <span class="sidebar-icon">ğŸ“†</span>
                                <span class="sidebar-label">Mein Kalender</span>
                            </button>
                            <button class="sidebar-subitem" data-view="probeorte">
                                <span class="sidebar-icon">ğŸ“</span>
                                <span class="sidebar-label">Probeorte</span>
                            </button>
                        </div>
                    </div>

                    <!-- 4. Auftritte -->
                    <div class="sidebar-group">
                        <button class="sidebar-item sidebar-main" data-view="events">
                            <span class="sidebar-icon">ğŸ¤</span>
                            <span class="sidebar-label">Auftritte</span>
                        </button>
                    </div>

                    <!-- 5. ANALYSE -->
                    <div class="sidebar-group has-submenu">
                        <button class="sidebar-item sidebar-main">
                            <span class="sidebar-icon">ğŸ“Š</span>
                            <span class="sidebar-label">Analyse</span>
                            <span class="submenu-arrow">â–¼</span>
                        </button>
                        <div class="sidebar-submenu">
                            <button class="sidebar-subitem" data-view="statistics">
                                <span class="sidebar-icon">ğŸ“ˆ</span>
                                <span class="sidebar-label">Statistiken</span>
                            </button>
                            <button class="sidebar-subitem" data-view="news">
                                <span class="sidebar-icon">ğŸ“°</span>
                                <span class="sidebar-label">News</span>
                            </button>
                        </div>
                    </div>

                    <!-- Feedback Button -->
                    <div class="sidebar-group" style="margin-top: auto;">
                        <button class="sidebar-item sidebar-main" id="feedbackBtnSidebar">
                            <span class="sidebar-icon">ğŸ“¢</span>
                            <span class="sidebar-label">Feedback</span>
                        </button>
                    </div>

                    <!-- 6. EINSTELLUNGEN -->
                    <div class="sidebar-group">
                        <button class="sidebar-item sidebar-main" id="openSettingsBtnSidebar">
                            <span class="sidebar-icon">âš™ï¸</span>
                            <span class="sidebar-label">Einstellungen</span>
                        </button>
                    </div>

                    <!-- Logout Button moved here for consistent styling -->
                    <div class="sidebar-group logout-group" style="margin-top: auto;">
                        <button id="sidebarLogoutBtn" class="sidebar-item sidebar-main">
                            <span class="sidebar-icon">ğŸšª</span>
                            <span class="sidebar-label">Abmelden</span>
                        </button>
                    </div>
                </nav>


            </aside>

            <!-- Main Content Wrapper (right of sidebar on desktop) -->
            <div class="app-main-wrapper">

                <!-- Header -->
                <header class="app-header">
                    <div class="header-content">
                        <h1 class="logo">
                            <span class="logo-emoji">ğŸ¸</span>
                            <span class="logo-text">
                                <span class="logo-part">Band</span>
                                <span class="logo-part">Management</span>
                                <span class="logo-part">Tool</span>
                            </span>
                        </h1>

                        <!-- Absence Indicator Badge -->
                        <div id="absenceIndicator" class="absence-indicator" style="display: none;">
                            <span class="absence-icon">ğŸ–ï¸</span>
                            <span class="absence-text">Abwesend bis <span id="absenceEndDate"></span></span>
                        </div>

                        <div id="headerPageTitle" class="header-page-title-main"></div>

                        <!-- Profile Image (separate for mobile left positioning) -->
                        <span id="headerProfileImage" class="profile-avatar"
                            style="display:inline-block;vertical-align:middle;margin-right:0.5em;width:36px;height:36px;border-radius:50%;background:#e5e7eb;overflow:hidden;text-align:center;line-height:36px;font-weight:600;font-size:1.1em;color:#444;"></span>

                        <div class="header-actions">
                            <span id="currentUserName" class="user-name">User</span>
                            <button id="themeToggleHeader" class="btn btn-icon" title="Dark Mode umschalten"
                                style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0; font-size: 1.25rem;">
                                <span id="themeToggleIcon">ğŸŒ™</span>
                            </button>
                            <button id="logoutBtn" class="btn btn-secondary">
                                <img src="images/logout darkmode.jpg" alt="Abmelden" class="icon-img">
                            </button>
                        </div>
                    </div>
                    <!-- Header container for submenu buttons (populated by JS) -->
                    <div id="headerSubmenu" class="header-submenu-nav" aria-live="polite"></div>

                    <!-- Navigation (now inside header on desktop) -->
                    <!-- HIDDEN IN FAVOR OF NEW SIDEBAR -->
                    <nav class="app-nav" id="appNav">
                        <!-- Home (Hauptreiter) -->
                        <div class="nav-group">
                            <button class="nav-item nav-main active" data-view="dashboard">
                                <span class="nav-icon">ğŸ™ï¸</span>
                                <span class="nav-label">Home</span>
                            </button>
                            <div class="nav-submenu">
                                <button class="nav-subitem active" data-view="dashboard">
                                    <span class="nav-icon">ğŸ </span>
                                    <span class="nav-label">Dashboard</span>
                                </button>
                                <button class="nav-subitem" data-view="bands">
                                    <span class="nav-icon">ğŸ¸</span>
                                    <span class="nav-label">Meine Bands</span>
                                </button>
                                <button class="nav-subitem" data-view="musikpool">
                                    <span class="nav-icon">ğŸµ</span>
                                    <span class="nav-label">Musikerpool</span>
                                </button>
                            </div>
                        </div>

                        <!-- Planung (Hauptreiter) -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="rehearsals">
                                <span class="nav-icon">ğŸ—“ï¸</span>
                                <span class="nav-label">Planung</span>
                            </button>
                            <div class="nav-submenu">
                                <button class="nav-subitem" data-view="rehearsals">
                                    <span class="nav-icon">ğŸ“…</span>
                                    <span class="nav-label">Probetermine</span>
                                </button>
                                <button class="nav-subitem" data-view="probeorte">
                                    <span class="nav-icon">ğŸ™ï¸</span>
                                    <span class="nav-label">Probeorte</span>
                                </button>
                                <button class="nav-subitem" data-view="kalender">
                                    <span class="nav-icon">ğŸ“†</span>
                                    <span class="nav-label">Mein Kalender</span>
                                </button>
                            </div>
                        </div>

                        <!-- Auftritte (Hauptreiter) -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="events">
                                <span class="nav-icon">ğŸ¸</span>
                                <span class="nav-label">Auftritte</span>
                            </button>
                        </div>

                        <!-- Analyse (Hauptreiter) -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="statistics">
                                <span class="nav-icon">ğŸ“Š</span>
                                <span class="nav-label">Analyse</span>
                            </button>
                            <div class="nav-submenu">
                                <button class="nav-subitem" data-view="statistics">
                                    <span class="nav-icon">ğŸ“Š</span>
                                    <span class="nav-label">Statistiken</span>
                                </button>
                                <button class="nav-subitem" data-view="news">
                                    <span class="nav-icon">ğŸ“°</span>
                                    <span class="nav-label">News</span>
                                </button>
                            </div>
                        </div>

                        <!-- Settings -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="settings">
                                <span class="nav-icon">âš™ï¸</span>
                                <span class="nav-label">Settings</span>
                            </button>
                        </div>
                    </nav>
                </header>

                <!-- News Banner (appears when there are unread news) -->
                <div id="newsBanner" class="news-banner" style="display: none;">
                    <div class="news-banner-content">
                        <span class="news-banner-icon">ğŸ“°</span>
                        <div class="news-banner-text">
                            <strong>Neue News verfÃ¼gbar!</strong>
                            <span id="newsBannerMessage">Es gibt ungelesene Updates</span>
                        </div>
                        <button id="newsBannerButton" class="btn btn-sm btn-primary">
                            Mehr Infos
                        </button>
                        <button id="newsBannerClose" class="news-banner-close" title="SchlieÃŸen">
                            Ã—
                        </button>
                    </div>
                </div>


                <!-- Main Content -->
                <main class="app-main">
                    <!-- Dashboard View -->
                    <div id="dashboardView" class="view active">
                        <!-- Dashboard Hero Section -->
                        <div id="dashboardHero" class="dashboard-hero">
                            <div class="hero-welcome">
                                <h2 class="welcome-text">Hallo <span id="welcomeUserName">Musiker</span>, Ready fÃ¼r den
                                    nÃ¤chsten Gig? ğŸ¸</h2>
                                <p class="hero-subtitle">Hier ist der Ãœberblick fÃ¼r deine musikalische Woche.</p>
                            </div>
                            <div id="nextEventHero" class="next-event-hero-card">
                                <div class="next-event-badge">NÃ¤chster Termin</div>
                                <div id="nextEventContent" class="next-event-content">
                                    <div class="next-event-placeholder">Lade nÃ¤chsten Termin...</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-grid">
                            <div class="dashboard-card stat-card">
                                <div class="card-icon icon-bands">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                </div>
                                <div class="card-content">
                                    <h3>Meine Bands</h3>
                                    <p class="card-stat" id="bandCount">0</p>
                                </div>
                            </div>
                            <div class="dashboard-card stat-card">
                                <div class="card-icon icon-events">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="m12 8-9.04 9.06a2.82 2.82 0 1 0 3.98 3.98l9.06-9.06"></path>
                                        <path d="M12 8a2.82 2.82 0 1 0 3.98 3.98l9.06-9.06"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </div>
                                <div class="card-content">
                                    <h3>NÃ¤chste Auftritte</h3>
                                    <p class="card-stat" id="upcomingEvents">0</p>
                                </div>
                            </div>
                            <div class="dashboard-card stat-card">
                                <div class="card-icon icon-rehearsals">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                </div>
                                <div class="card-content">
                                    <h3>Proben</h3>
                                    <p class="card-stat" id="totalRehearsals">0</p>
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard Sections in Bento Layout -->
                        <div class="dashboard-bento-grid">
                            <div class="dashboard-section news-section" id="dashboardNewsSection">
                                <div class="dashboard-section-header">
                                    <h3>ğŸ“° Letzte News</h3>
                                    <div class="section-header-actions">
                                        <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                    </div>
                                </div>
                                <div id="dashboardNewsList" class="dashboard-news-list"></div>
                            </div>

                            <div class="dashboard-section quick-access-section" id="dashboardQuickAccessSection">
                                <div class="dashboard-section-header">
                                    <h3>âš¡ Schnellzugriff</h3>
                                    <div class="section-header-actions">
                                        <button id="editQuickAccessBtn" class="btn btn-icon-sm"
                                            title="Bearbeiten">âœï¸</button>
                                        <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                    </div>
                                </div>
                                <div class="dashboard-quick-links" id="dashboardQuickLinks"></div>
                            </div>

                            <div class="dashboard-section calendar-section" id="dashboardCalendarSection">
                                <div class="dashboard-section-header">
                                    <h3>ğŸ“… Kalender-Abo</h3>
                                    <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                </div>
                                <div class="calendar-sync-card">
                                    <p>Verpasse keinen Termin mehr durch die Kalender-Synchronisation.</p>
                                    <button class="btn btn-primary btn-sm" onclick="App.navigateTo('kalender')">Sync
                                        einrichten</button>
                                </div>
                            </div>

                            <div class="dashboard-section activity-section" id="dashboardActivitySection">
                                <div class="dashboard-section-header">
                                    <h3>âœ¨ AktivitÃ¤ten</h3>
                                    <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                </div>
                                <div id="dashboardActivityList" class="dashboard-activity-list"></div>
                            </div>
                        </div>

                        <div class="section">
                            <br>
                            <h3>NÃ¤chste Termine</h3>
                            <div id="upcomingList" class="rehearsal-list"></div>
                        </div>
                    </div>

                    <!-- Bands View -->
                    <div id="bandsView" class="view">
                        <div class="view-actions-bar">
                            <button id="createBandBtnView" class="btn btn-primary">
                                + Band erstellen
                            </button>
                            <button id="joinBandBtn" class="btn btn-secondary btn-bands-join-modal">
                                Band beitreten
                            </button>
                        </div>
                        <div id="bandsList" class="bands-grid"></div>
                    </div>

                    <!-- Events View -->
                    <div id="eventsView" class="view">
                        <div class="view-actions-bar">
                            <select id="eventBandFilter" class="form-select">
                                <option value="">Alle Bands</option>
                            </select>
                            <button id="createEventBtn" class="btn btn-primary">+ Neuer Auftritt</button>
                        </div>
                        <div id="eventsList" class="events-list"></div>
                    </div>

                    <!-- Rehearsals View -->
                    <div id="rehearsalsView" class="view">
                        <div class="view-actions-bar">
                            <select id="bandFilter" class="form-select">
                                <option value="">Alle Bands</option>
                            </select>
                            <button id="createRehearsalBtn" class="btn btn-primary">+ Neuer Probetermin</button>
                        </div>
                        <div id="rehearsalsListPendingHeader" class="rehearsal-section-header">
                            <h3>ğŸ‘‹ Offene Abstimmungen</h3>
                        </div>
                        <div id="rehearsalsListPending" class="rehearsal-list" style="margin-bottom: 2rem;"></div>

                        <div id="rehearsalsListVotedHeader" class="rehearsal-section-header">
                            <h3>âœ… Bereits abgestimmt</h3>
                        </div>
                        <div id="rehearsalsListVoted" class="rehearsal-list"></div>

                        <div id="rehearsalsListResolvedHeader" class="rehearsal-section-header"
                            style="margin-top: 2rem; opacity: 0.8;">
                            <h3>âœ… BestÃ¤tigte Proben</h3>
                        </div>
                        <div id="rehearsalsListResolved" class="rehearsal-list resolved-list" style="opacity: 0.8;">
                        </div>
                    </div>

                    <!-- Statistics View -->
                    <div id="statisticsView" class="view">
                        <div class="view-actions-bar">
                            <select id="statsBandSelect" class="form-select" style="width: 100%;">
                                <option value="">Band auswÃ¤hlen</option>
                            </select>
                        </div>
                        <div id="statisticsContent" class="statistics-content-modern">
                            <!-- Helper container for the dashboard -->
                            <div id="statsDashboardContainer" class="stats-dashboard-container">
                                <!-- Content will be injected via JS -->
                            </div>
                        </div>
                    </div>

                    <!-- News & Updates View -->
                    <div id="newsView" class="view">
                        <div class="view-actions-bar">
                            <a href="#" id="donateBtn" class="btn btn-secondary"
                                style="display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none;">
                                ğŸ’– Spenden
                            </a>
                            <button id="createNewsBtn" class="btn btn-primary" style="display: none;">+ News
                                erstellen</button>
                        </div>
                        <div id="newsContainer" class="news-content">
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ“°</div>
                                <p>Noch keine News oder Updates vorhanden.</p>
                                <p>Hier wirst du auf dem laufenden gehalten.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Probeorte View -->
                    <div id="probeorteView" class="view">

                        <!-- Submenu for calendar selection -->
                        <div class="calendar-submenu">
                            <button id="probeorteBtnTonstudio" class="calendar-tab active" data-calendar="tonstudio">
                                ğŸ™ï¸ Tonstudio
                            </button>
                            <button id="probeorteBtnFesthalle" class="calendar-tab" data-calendar="festhalle">
                                ğŸ›ï¸ JMS Festhalle
                            </button>
                            <button id="probeorteBtnAnkersaal" class="calendar-tab" data-calendar="ankersaal">
                                âš“ Ankersaal
                            </button>
                            <!-- refresh button removed per request -->
                        </div>

                        <div class="section">
                            <!-- Tonstudio Calendar -->
                            <div id="tonstudioCalendar" class="calendar-container active">
                                <div id="tonstudioEventsContainer" style="min-height: 400px;">
                                    <!-- Events will be rendered here -->
                                </div>
                            </div>

                            <!-- Festhalle Calendar -->
                            <div id="festhalleCalendar" class="calendar-container">
                                <div id="festhalleEventsContainer" style="min-height: 400px;">
                                    <!-- Events will be rendered here -->
                                </div>
                            </div>

                            <!-- Ankersaal Calendar -->
                            <div id="ankersaalCalendar" class="calendar-container">
                                <div id="ankersaalEventsContainer" style="min-height: 400px;">
                                    <!-- Events will be rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kalender View -->
                    <div id="kalenderView" class="view">

                        <div class="section">
                            <div id="personalCalendarContainer">
                                <!-- Personal calendar will be rendered here -->
                            </div>
                            <div>
                                <br>
                                <span style="font-size:0.9rem; color:var(--color-text-secondary); line-height:1.4;">
                                    Abonniere jetzt deinen Kalender in deinem Apple- oder Samsung-Kalender, um nichts
                                    mehr
                                    zu verpassen!
                                    <br></span>
                                <button id="subscribePersonalCalendarBtn" class="btn btn-secondary"
                                    onclick="PersonalCalendar.exportICS()"
                                    style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                    ğŸ”— Kalender abonnieren
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Musikerpool View -->
                    <div id="musikpoolView" class="view">
                        <div class="view-actions-bar">
                            <button id="refreshMusikpoolBtn" class="btn btn-secondary"
                                style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                ğŸ”„ Aktualisieren
                            </button>
                        </div>

                        <!-- Eigene Mitglieder Section -->
                        <div class="section">
                            <div class="section-header">
                                <h3>Eigene Mitglieder</h3>
                                <button id="addOwnMemberBtn" class="btn btn-primary"
                                    style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                    â• Mitglied hinzufÃ¼gen
                                </button>
                            </div>
                            <div id="ownMembersContainer">
                                <div class="empty-state">
                                    <div class="empty-icon">ğŸ‘¥</div>
                                    <p>Noch keine eigenen Mitglieder angelegt</p>
                                    <p
                                        style="color: var(--color-text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                                        Hier kÃ¶nnen Sie eigene Musiker und Kontakte hinzufÃ¼gen.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- ChurchTools Pool Section -->
                        <div id="churchToolsMusikpoolSection" class="section">
                            <div
                                style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: var(--spacing-lg);">
                                <h3 style="margin-bottom: 0;">ChurchTools Musikpool</h3>
                                <span class="admin-badge">Nur fÃ¼r Admins sichtbar</span>
                            </div>
                            <button id="refreshMusikpoolBtn" class="btn btn-secondary"
                                style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                ğŸ”„ Aktualisieren
                            </button>
                            <div id="musikpoolContainer">
                                <!-- ChurchTools members will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Settings View -->
                    <!-- Settings View Removed -->
                </main>
            </div> <!-- End app-main-wrapper -->
        </div> <!-- End app -->

        <!-- Modal: Schnellzugriff bearbeiten -->
        <div id="quickAccessModal" class="modal">
            <div class="modal-content" style="max-width: 420px;">
                <h2>Schnellzugriff bearbeiten</h2>
                <form id="quickAccessForm">
                    <div id="quickAccessOptions"
                        style="display: flex; flex-direction: column; gap: 0.7rem; margin: 1rem 0;"></div>
                    <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                        <button type="button" class="btn btn-secondary" id="cancelQuickAccessBtn">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Absences Content (for inclusion in Settings) -->
        <div id="absencesSettingsContent" style="display: none;">
            <!-- Create Absence Section -->
            <div class="absence-form-container">
                <h3>Neue Abwesenheit eintragen</h3>
                <form id="createAbsenceForm">
                    <input type="hidden" id="editAbsenceId">
                    <div class="form-group">
                        <label for="absenceStart">Von (Datum)</label>
                        <input type="date" id="absenceStart" required>
                    </div>
                    <div class="form-group">
                        <label for="absenceEnd">Bis (Datum)</label>
                        <input type="date" id="absenceEnd" required>
                    </div>
                    <div class="form-group">
                        <label for="absenceReason">Grund (optional)</label>
                        <input type="text" id="absenceReason" placeholder="z.B. Urlaub, Krankheit...">
                    </div>
                    <div style="display:flex; gap:0.5rem; align-items:center;">
                        <button type="submit" id="saveAbsenceBtn" class="btn btn-primary">Abwesenheit
                            hinzufÃ¼gen</button>
                        <button type="button" id="cancelEditAbsenceBtn" class="btn btn-secondary"
                            style="display:none;">Abbrechen</button>
                    </div>
                </form>
            </div>

            <!-- List Absences Section -->
            <div class="section">
                <h3>Meine eingetragenen Abwesenheiten</h3>
                <div id="absencesList"></div>
            </div>
        </div>

        <!-- Hidden container end -->
        <div style="display: none;">
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="settings-tabs">
                        <button id="settingsTabProfile" class="settings-tab-btn active"
                            data-tab="profile">Profil</button>
                        <button id="settingsTabAbsences" class="settings-tab-btn"
                            data-tab="absences">Abwesenheiten</button>
                        <button id="settingsTabAdmin" class="settings-tab-btn" data-tab="admin"
                            style="display: none;">Admin</button>
                    </div>




                    <!-- Profile Tab -->
                    <div id="profileSettingsTab" class="settings-tab-content active">
                        <div class="section">
                            <h3 style="margin-bottom: 1.5rem;">Mein Profil & Einstellungen</h3>

                            <form id="updateProfileForm" class="profile-settings-grid">

                                <!-- Removed separate sidebar column -->

                                <!-- Right Column: Form Fields -->
                                <div class="profile-main-column">

                                    <!-- Personal Info -->
                                    <div class="profile-section">
                                        <div class="profile-section-title">
                                            <span>ğŸ‘¤</span> PersÃ¶nliche Daten
                                        </div>
                                        <div class="profile-form-grid">
                                            <!-- Avatar Section Merged -->
                                            <div class="profile-avatar-merged-section full-width">
                                                <div class="profile-avatar-wrapper small-merged">
                                                    <div id="profileImageSettingsContainer"
                                                        style="width:100%; height:100%; border-radius:50%; overflow:hidden;">
                                                        <!-- Profile Image Rendered by JS -->
                                                    </div>
                                                    <label for="profileImageInput" class="profile-avatar-edit-btn"
                                                        title="Profilbild Ã¤ndern">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                            stroke-width="2" stroke-linecap="round"
                                                            stroke-linejoin="round">
                                                            <path
                                                                d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                                                            </path>
                                                            <circle cx="12" cy="13" r="4"></circle>
                                                        </svg>
                                                    </label>
                                                    <input type="file" id="profileImageInput" accept="image/*" hidden>
                                                </div>
                                                <div class="profile-sub-actions">
                                                    <h4 id="profileDisplayNamePreview" style="margin:0 0 0.5rem 0;">Dein
                                                        Profil</h4>
                                                    <button type="button" id="deleteProfileImageBtn"
                                                        class="btn-image-remove">
                                                        Bild entfernen
                                                    </button>
                                                </div>
                                            </div>
                                            <!-- Personal Data Fields -->
                                            <div class="form-group">
                                                <label for="profileFirstName">Vorname</label>
                                                <input type="text" id="profileFirstName" class="profile-form-input"
                                                    required placeholder="Dein Vorname">
                                            </div>
                                            <div class="form-group">
                                                <label for="profileLastName">Nachname</label>
                                                <input type="text" id="profileLastName" class="profile-form-input"
                                                    required placeholder="Dein Nachname">
                                            </div>
                                            <div class="form-group full-width">
                                                <label for="profileUsername">Benutzername</label>
                                                <input type="text" id="profileUsername" class="profile-form-input"
                                                    required placeholder="@username">
                                            </div>
                                            <div class="form-group full-width">
                                                <label for="profileEmail">E-Mail Adresse</label>
                                                <input type="email" id="profileEmail" class="profile-form-input"
                                                    required placeholder="name@example.com">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Artist Info -->
                                    <div class="profile-section">
                                        <div class="profile-section-title">
                                            <span>ğŸ¸</span> Musiker Profil
                                        </div>
                                        <div class="form-group full-width">
                                            <label for="profileInstrument">Hauptinstrument</label>
                                            <select id="profileInstrument" class="profile-form-input">
                                                <option value="">Kein Instrument gewÃ¤hlt</option>
                                                <option value="drums">Schlagzeug (ğŸ¥)</option>
                                                <option value="bass">Bass (ğŸ¸)</option>
                                                <option value="acoustic_guitar">Akustische Gitarre (ğŸ¸)</option>
                                                <option value="electric_guitar">Elektrische Gitarre (ğŸ¸)</option>
                                                <option value="keyboard">Keyboard (ğŸ¹)</option>
                                                <option value="synth">Synth (ğŸ¹)</option>
                                                <option value="violin">Geige (ğŸ»)</option>
                                                <option value="vocals">Gesang (ğŸ¤)</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Security -->
                                    <div class="profile-section">
                                        <div class="profile-section-title">
                                            <span>ğŸ”’</span> Sicherheit
                                        </div>
                                        <div class="profile-form-grid">
                                            <div class="form-group">
                                                <label for="profilePassword">Neues Passwort</label>
                                                <input type="password" id="profilePassword" class="profile-form-input"
                                                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password">
                                            </div>
                                            <div class="form-group" id="profilePasswordConfirmGroup">
                                                <label for="profilePasswordConfirm">BestÃ¤tigen</label>
                                                <input type="password" id="profilePasswordConfirm"
                                                    class="profile-form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                                    autocomplete="new-password">
                                            </div>
                                        </div>
                                        <small
                                            style="display:block; margin-top:0.5rem; color:var(--color-text-secondary);">Leer
                                            lassen, wenn du dein Passwort nicht Ã¤ndern mÃ¶chtest.</small>
                                    </div>

                                    <!-- Actions -->
                                    <div class="settings-form-actions">
                                        <button type="submit" class="btn btn-primary btn-save">
                                            <span>ğŸ’¾</span> Ã„nderungen speichern
                                        </button>
                                        <button id="deleteAccountBtn" class="btn btn-danger-soft">
                                            Account lÃ¶schen
                                        </button>
                                        <div style="text-align: center; margin-top: 1rem; width: 100%;">
                                            <a href="privacy.html" class="privacy-link"
                                                style="color: var(--color-text-secondary); font-size: 0.8rem; text-decoration: none;">DatenschutzerklÃ¤rung</a>
                                        </div>
                                    </div>

                                </div>
                            </form>
                            <!-- (Tutorial and Donate moved to Admin tab) -->
                            <!-- (Tutorial and Donate moved to Admin tab) -->
                        </div>
                    </div>

                    <!-- Absences Tab -->
                    <div id="absencesSettingsTab" class="settings-tab-content">
                        <div class="absences-settings-grid">

                            <!-- Left Column: List of Absences -->
                            <div class="absences-list-column">
                                <h3 style="margin-bottom: 0.5rem;">Meine Abwesenheiten</h3>
                                <p style="color:var(--color-text-secondary); margin-bottom:1rem; font-size:0.9rem;">
                                    Hier siehst du alle deine eingetragenen Urlaube und Fehlzeiten.
                                </p>
                                <div id="absencesListSettings">
                                    <!-- Populated by JS -->
                                    <div class="empty-state">Lade Abwesenheiten...</div>
                                </div>
                            </div>

                            <!-- Right Column: Create/Edit Form -->
                            <div class="absences-form-column">
                                <h3
                                    style="margin-bottom: 1.25rem; font-size:1.1rem; border-bottom:1px solid var(--color-border); padding-bottom:0.75rem;">
                                    Neuer Eintrag
                                </h3>

                                <form id="createAbsenceFormSettings">
                                    <input type="hidden" id="editAbsenceIdSettings">

                                    <div class="form-group">
                                        <label for="absenceStartSettings">Von</label>
                                        <input type="date" id="absenceStartSettings" class="profile-form-input"
                                            required>
                                    </div>

                                    <div class="form-group">
                                        <label for="absenceEndSettings">Bis</label>
                                        <input type="date" id="absenceEndSettings" class="profile-form-input" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="absenceReasonSettings">Grund</label>
                                        <input type="text" id="absenceReasonSettings" class="profile-form-input"
                                            placeholder="Urlaub, Krankheit, ..." required>
                                    </div>

                                    <div class="settings-form-actions absence-form-actions">
                                        <button type="submit" id="saveAbsenceBtnSettings" class="btn btn-primary">
                                            Speichern
                                        </button>
                                        <button type="button" id="cancelEditAbsenceBtnSettings"
                                            class="btn btn-secondary" style="display:none;">
                                            Abbrechen
                                        </button>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>

                    <!-- ADMIN TAB (New Consolidated Tab) -->
                    <div id="adminSettingsTab" class="settings-tab-content">

                        <!-- 1. Admin Feedback -->
                        <div class="admin-accordion-card" id="adminSectionFeedback">
                            <button class="admin-accordion-header"
                                onclick="UI.toggleAdminAccordion('adminSectionFeedback')">
                                <h3><span>ğŸ“¢</span> Admin Feedback <span id="adminFeedbackCount"
                                        class="admin-count-badge">0</span></h3>
                                <span class="admin-accordion-toggle-icon">â–¼</span>
                            </button>
                            <div class="admin-accordion-content">
                                <div class="admin-section-inner">

                                    <div class="view-controls"
                                        style="margin-bottom: 1rem; display:flex; justify-content:flex-end;">
                                        <button id="refreshFeedbackBtn" class="btn btn-sm btn-secondary">ğŸ”„
                                            Aktualisieren</button>
                                    </div>
                                    <div id="adminFeedbackList" class="admin-scroll-list">
                                        <div class="empty-state">Lade Daten...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. Bandmanagement -->
                        <div class="admin-accordion-card" id="adminSectionBands">
                            <button class="admin-accordion-header"
                                onclick="UI.toggleAdminAccordion('adminSectionBands')">
                                <h3><span>ğŸ¸</span> Bandmanagement <span id="adminBandCount"
                                        class="admin-count-badge">0</span></h3>
                                <span class="admin-accordion-toggle-icon">â–¼</span>
                            </button>
                            <div class="admin-accordion-content">
                                <div class="admin-section-inner">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <p class="help-text">Erstelle neue Bands oder verwalte bestehende.</p>
                                        <button id="createBandBtn" class="btn btn-primary btn-sm">+ Neu</button>
                                    </div>
                                    <div id="allBandsList" class="admin-scroll-list"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 3. Benutzerverwaltung -->
                        <div class="admin-accordion-card" id="adminSectionUsers">
                            <button class="admin-accordion-header"
                                onclick="UI.toggleAdminAccordion('adminSectionUsers')">
                                <h3><span>ğŸ‘¥</span> Benutzerverwaltung <span id="adminUserCount"
                                        class="admin-count-badge">0</span></h3>
                                <span class="admin-accordion-toggle-icon">â–¼</span>
                            </button>
                            <div class="admin-accordion-content">
                                <div class="admin-section-inner">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <p class="help-text">Verwalte alle registrierten Benutzer</p>
                                        <button id="addUserBtn" class="btn btn-primary btn-sm">â• Neu</button>
                                    </div>
                                    <div id="usersList" class="admin-scroll-list"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 4. Probeorte (Kalender) -->
                        <div class="admin-accordion-card" id="adminSectionLocations">
                            <button class="admin-accordion-header"
                                onclick="UI.toggleAdminAccordion('adminSectionLocations')">
                                <h3><span>ğŸ“</span> Probeorte & Kalender <span id="adminLocationCount"
                                        class="admin-count-badge">0</span></h3>
                                <span class="admin-accordion-toggle-icon">â–¼</span>
                            </button>
                            <div class="admin-accordion-content">
                                <div class="admin-section-inner">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <p class="help-text">Verwalte iCal-Kalender fÃ¼r die VerfÃ¼gbarkeitsprÃ¼fung von
                                            Probeorten</p>
                                        <button id="addCalendarBtn" class="btn btn-primary btn-sm">â• Neu</button>
                                    </div>
                                    <div id="calendarsList" class="calendars-list"></div>

                                    <div
                                        style="margin-top:2rem; padding-top:1.5rem; border-top:1px solid var(--color-border);">
                                        <h4>Neuer Probeort</h4>
                                        <form id="createLocationForm" class="inline-form" style="margin-top:1rem;">
                                            <div class="form-group">
                                                <input type="text" id="newLocationName"
                                                    placeholder="Name (z.B. Proberaum A)" required
                                                    class="profile-form-input">
                                                <input type="text" id="newLocationAddress"
                                                    placeholder="Adresse (Optional)" class="profile-form-input"
                                                    style="margin-top:0.5rem;">
                                            </div>
                                            <div class="form-group" style="margin-top:1rem;">
                                                <label for="newLocationLinkedCalendar">Mit Kalender verknÃ¼pfen:</label>
                                                <select id="newLocationLinkedCalendar"
                                                    class="form-select profile-form-input">
                                                    <option value="">Lade Kalender...</option>
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-primary"
                                                style="margin-top:1rem; width:100%;">Probeort hinzufÃ¼gen</button>
                                        </form>
                                    </div>

                                    <div style="margin-top:2rem;">
                                        <h4>Vorhandene Probeorte</h4>
                                        <div id="locationsList" class="admin-scroll-list"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 5. Spenden -->
                        <div class="admin-accordion-card" id="adminSectionExtras">
                            <button class="admin-accordion-header"
                                onclick="UI.toggleAdminAccordion('adminSectionExtras')">
                                <h3><span>ğŸ’</span> Spenden</h3>
                                <span class="admin-accordion-toggle-icon">â–¼</span>
                            </button>
                            <div class="admin-accordion-content">
                                <div class="admin-section-inner">
                                    <!-- Spenden Link -->
                                    <div id="donateLinkSection">
                                        <h4>Spenden-Link</h4>
                                        <div class="form-group" style="margin-top:0.75rem;">
                                            <input type="url" id="donateLink"
                                                placeholder="https://paypal.me/deinusername" value=""
                                                class="profile-form-input">
                                            <small
                                                style="color: var(--color-text-secondary); display: block; margin-top: 0.5rem;">
                                                Gib hier deinen PayPal.me-Link ein. Er wird im News-Bereich
                                                angezeigt.
                                            </small>
                                        </div>
                                        <button id="saveDonateLink" class="btn btn-primary"
                                            style="margin-top:1rem; width:100%;">Spenden-Link speichern</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



            </div>

        </div>
    </div>
    </div>



    <!-- Create Band Modal -->
    <div id="createBandModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Neue Band erstellen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createBandForm">
                <div class="form-group">
                    <label for="bandName">Bandname</label>
                    <input type="text" id="bandName" required>
                </div>
                <div class="form-group">
                    <label for="bandDescription">Beschreibung</label>
                    <textarea id="bandDescription" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Band erstellen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Band Modal -->
    <div id="editBandModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Band bearbeiten</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="editBandForm">
                <input type="hidden" id="editBandId">
                <div class="form-group">
                    <label for="editBandName">Bandname</label>
                    <input type="text" id="editBandName" required>
                </div>
                <div class="form-group">
                    <label for="editBandDescription">Beschreibung</label>
                    <textarea id="editBandDescription" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Location Modal -->
    <div id="editLocationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Probeort bearbeiten</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="editLocationForm">
                <input type="hidden" id="editLocationId">
                <div class="form-group">
                    <label for="editLocationName">Name</label>
                    <input type="text" id="editLocationName" required>
                </div>
                <div class="form-group">
                    <label for="editLocationAddress">Adresse</label>
                    <input type="text" id="editLocationAddress">
                </div>
                <div class="form-group">
                    <label for="editLocationLinkedCalendar">Mit Kalender verknÃ¼pfen:</label>
                    <select id="editLocationLinkedCalendar" class="form-select">
                        <option value="">Nicht verknÃ¼pft</option>
                        <option value="tonstudio">ğŸ™ï¸ Tonstudio</option>
                        <option value="festhalle">ğŸ›ï¸ JMS Festhalle</option>
                        <option value="ankersaal">âš“ Ankersaal</option>
                    </select>
                    <p class="help-text">WÃ¤hle einen Kalender, um bei der Probe-Erstellung die VerfÃ¼gbarkeit zu
                        prÃ¼fen.
                    </p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Band Details Modal -->
    <div id="bandDetailsModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h2 id="bandDetailsName"></h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="members">Mitglieder</button>
                    <button class="tab-btn" data-tab="absences" id="bandAbsencesTabBtn">Abwesenheiten</button>
                    <button class="tab-btn" data-tab="setlist">Setlist</button>
                    <button class="tab-btn" data-tab="settings">Settings</button>
                </div>

                <!-- Members Tab -->
                <div id="membersTab" class="tab-content active">
                    <div class="section">
                        <div class="section-header section-header-mobile-adjust">
                            <h3>Bandmitglieder</h3>
                            <button id="addMemberBtn" class="btn btn-primary btn-sm">+ Mitglied<span
                                    class="mobile-hidden-text"> hinzufÃ¼gen</span></button>
                        </div>
                        <div id="membersList" class="members-list"></div>
                    </div>
                </div>

                <!-- Setlist Tab -->
                <div id="setlistTab" class="tab-content">
                    <div class="section">
                        <div id="bandSongsList"></div>
                    </div>
                </div>

                <!-- Absences Tab -->
                <div id="absencesTab" class="tab-content">
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="tab-content">
                    <div class="section" id="bandSettingsSection">
                        <h3>Band-Einstellungen</h3>
                        <div class="settings-actions">
                            <div style="margin-bottom:0.5em;color:#b91c1c;font-weight:bold;; font-size: smaller;">
                                Achtung: Beim LÃ¶schen werden alle zugehÃ¶rigen Songs, Probetermine und Auftritte
                                <u>unwiderruflich</u> entfernt!
                            </div>
                            <button id="deleteBandBtn" class="btn btn-danger" style="width: 150px;">Band
                                lÃ¶schen</button>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mitglied hinzufÃ¼gen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="addMemberForm">
                <div class="form-group">
                    <label for="memberUsername">Benutzername</label>
                    <input type="text" id="memberUsername" required>
                </div>
                <div class="form-group">
                    <label for="memberRole">Rolle</label>
                    <select id="memberRole" required>
                        <option value="member">Mitglied</option>
                        <option value="co-leader">Co-Leiter</option>
                        <option value="leader">Leiter</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">HinzufÃ¼gen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Songs Modal -->
    <div id="importSongsModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h2>Songs importieren</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem;">Du kannst mehrere Songs gleichzeitig per CSV-Datei importieren.
                </p>

                <div class="import-info-box">
                    <h4 class="import-info-title">Erforderliches Format:</h4>
                    <div class="import-table-wrapper">
                        <table class="import-table">
                            <thead>
                                <tr>
                                    <th>Titel</th>
                                    <th>Interpret</th>
                                    <th>BPM</th>
                                    <th>Time</th>
                                    <th>Key</th>
                                    <th>Orig.</th>
                                    <th>Lead</th>
                                    <th>Sprache</th>
                                    <th>Tracks</th>
                                    <th>Infos</th>
                                    <th>CCLI</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Amazing Grace</td>
                                    <td>John Newton</td>
                                    <td>80</td>
                                    <td>4/4</td>
                                    <td>G</td>
                                    <td>C</td>
                                    <td>John</td>
                                    <td>DE</td>
                                    <td>Nein</td>
                                    <td>Start ruhig</td>
                                    <td>123456</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="import-hint">
                        âš ï¸ Wichtig: Wenn du Excel oder Numbers verwendest, wÃ¤hle bitte "Exportieren als CSV".
                    </p>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn cancel"
                        onclick="UI.closeModal('importSongsModal')">Abbrechen</button>
                    <button type="button" class="btn btn-primary"
                        onclick="document.getElementById('csvSongUpload').click()">
                        ğŸ“‚ CSV-Datei auswÃ¤hlen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal (Admin Only) -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Neues Mitglied anlegen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="addUserForm">
                <div class="form-group">
                    <label for="newUserFirstName">Vorname <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="text" id="newUserFirstName" required>
                </div>
                <div class="form-group">
                    <label for="newUserLastName">Nachname <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="text" id="newUserLastName" required>
                </div>
                <div class="form-group">
                    <label for="newUserEmail">E-Mail <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="email" id="newUserEmail" required>
                </div>
                <div class="form-group">
                    <label for="newUserUsername">Benutzername <span style="color:red;"
                            title="Pflichtfeld">*</span></label>
                    <input type="text" id="newUserUsername" required>
                </div>
                <div class="form-group">
                    <label for="newUserPassword">Passwort <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="password" id="newUserPassword" required minlength="6">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Mitglied anlegen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Rehearsal Modal -->
    <div id="createRehearsalModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="rehearsalModalTitle">Neuen Probetermin vorschlagen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createRehearsalForm">
                <input type="hidden" id="editRehearsalId">
                <div class="form-group">
                    <label for="rehearsalBand">Band <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <select id="rehearsalBand" required>
                        <option value="">Band auswÃ¤hlen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rehearsalTitle">Titel <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="text" id="rehearsalTitle" required>
                </div>
                <div class="form-group">
                    <label for="rehearsalLocation">Ort (Optional)</label>
                    <select id="rehearsalLocation">
                        <option value="">Kein Ort ausgewÃ¤hlt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rehearsalDescription">Beschreibung</label>
                    <textarea id="rehearsalDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="rehearsalEvent">Zugewiesener Auftritt (Optional)</label>
                    <select id="rehearsalEvent">
                        <option value="">Kein Auftritt ausgewÃ¤hlt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>TerminvorschlÃ¤ge</label>
                    <div id="dateProposals" class="date-proposals">
                        <div class="date-proposal-item" data-confirmed="false">
                            <div class="date-time-range">
                                <input type="date" class="date-input-date" id="dateInputDate">
                                <input type="time" class="date-input-start" id="dateInputStart">
                                <span class="time-separator">bis</span>
                                <input type="time" class="date-input-end" id="dateInputEnd">
                            </div>
                            <span class="date-availability" style="margin-left:8px"></span>
                            <button type="button" class="btn btn-sm confirm-proposal-btn">âœ“
                                BestÃ¤tigen</button>
                            <button type="button" class="btn-icon remove-date" disabled>ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <button type="button" id="addDateBtn" class="btn btn-secondary btn-sm">+ Weiteren
                        Termin
                        hinzufÃ¼gen</button>
                </div>
                <div class="form-group checkbox-group" id="notifyMembersGroup" style="display: none;">
                    <div class="checkbox-item">
                        <input type="checkbox" id="notifyMembersOnUpdate">
                        <label for="notifyMembersOnUpdate">Update-E-Mail an alle Beteiligten
                            senden</label>
                    </div>
                </div>

                <!-- Update Email Section (only for confirmed rehearsals when editing) -->
                <div id="updateEmailSection"
                    style="display: none; margin-top: 1rem; padding: 1rem; background: var(--color-bg-secondary); border-radius: var(--radius-md); border-left: 3px solid var(--color-warning);">
                    <h3 style="margin: 0 0 0.5rem 0; font-size: 1rem;">ğŸ“§ Update-Email versenden</h3>
                    <div class="checkbox-item" style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="sendUpdateEmail" />
                        <label for="sendUpdateEmail" style="cursor: pointer; margin: 0;">Bandmitglieder
                            Ã¼ber Ã„nderungen informieren</label>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="button" class="btn btn-danger" id="deleteRehearsalBtn"
                        style="display:none; margin-right: auto;">ğŸ—‘ï¸ LÃ¶schen</button>
                    <button type="submit" class="btn btn-primary" id="saveRehearsalBtn">Vorschlag
                        erstellen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rehearsal Details Modal -->
    <div id="rehearsalDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="rehearsalDetailsTitle"></h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="rehearsalDetailsContent"></div>
            </div>
        </div>
    </div>

    <!-- Confirm Rehearsal Modal -->
    <!-- Time Suggestion Modal -->
    <div id="timeSuggestionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Uhrzeit vorschlagen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="suggestTimeRehearsalId">
                <input type="hidden" id="suggestTimeDateIndex">

                <div class="form-group">
                    <label for="suggestedTimeInput">Welche Uhrzeit wÃ¼rdest du vorschlagen?</label>
                    <input type="time" id="suggestedTimeInput" class="form-control" required>
                    <small class="help-text">WÃ¤hle eine Uhrzeit aus, die besser fÃ¼r dich passt</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="button" id="deleteTimeSuggestionBtn" class="btn btn-secondary"
                        style="display: none;">ğŸ—‘ï¸ Vorschlag lÃ¶schen</button>
                    <button type="button" id="saveTimeSuggestionBtn" class="btn btn-primary">ğŸ’¾
                        Speichern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Rehearsal Modal -->
    <div id="confirmRehearsalModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Probe bestÃ¤tigen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="confirmRehearsalId">
                <input type="hidden" id="confirmDateIndex">

                <div class="section">
                    <h3>Probendetails bearbeiten</h3>
                    <div class="form-group">
                        <label for="confirmRehearsalTitle">Titel <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="text" id="confirmRehearsalTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmRehearsalDescription">Beschreibung (optional)</label>
                        <textarea id="confirmRehearsalDescription" class="form-control" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="confirmRehearsalStartTime">Von (Start) <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="datetime-local" id="confirmRehearsalStartTime" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmRehearsalEndTime">Bis (Ende) <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="datetime-local" id="confirmRehearsalEndTime" class="form-control" required>
                    </div>
                </div>

                <div class="section">
                    <h3>Probeort auswÃ¤hlen</h3>
                    <select id="confirmRehearsalLocation" class="form-select">
                        <option value="">Kein Ort ausgewÃ¤hlt</option>
                    </select>
                </div>

                <div class="section">
                    <h3>Bandmitglieder benachrichtigen</h3>
                    <p class="help-text">WÃ¤hle aus, welche Bandmitglieder eine BestÃ¤tigungs-E-Mail
                        erhalten
                        sollen:
                    </p>
                    <div id="confirmMembersList" class="confirm-members-list"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="button" id="sendConfirmationBtn" class="btn btn-primary">âœ… Probe
                        bestÃ¤tigen &
                        E-Mail
                        senden</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Location Conflict Warning Modal -->
    <div id="locationConflictModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš ï¸ Probeort belegt</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="conflictDetails" class="conflict-details"></div>

                <p style="margin-top: 1rem; color: var(--color-text-secondary);">
                    MÃ¶chtest du trotzdem fortfahren?
                </p>

                <div class="modal-actions">
                    <button type="button" class="btn cancel" id="abortConfirmationBtn">Abbrechen</button>
                    <button type="button" class="btn btn-primary" id="proceedAnywayBtn">Trotzdem
                        fortfahren</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Calendar Modal -->
    <div id="calendarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="calendarModalTitle">Neuen Kalender hinzufÃ¼gen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="calendarForm">
                <input type="hidden" id="editCalendarId">
                <div class="form-group">
                    <label for="calendarName">Name <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="text" id="calendarName" placeholder="z.B. Mein Proberaum" required>
                </div>
                <div class="form-group">
                    <label for="calendarIcon">Icon (Emoji)</label>
                    <input type="text" id="calendarIcon" placeholder="ğŸ“…" maxlength="2"
                        style="font-size: 1.5rem; text-align: center;">
                    <small style="color: var(--color-text-secondary); font-size: 0.875rem;">
                        Optional: Ein Emoji zur visuellen Kennzeichnung
                    </small>
                </div>
                <div class="form-group">
                    <label for="calendarUrl">iCal URL <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="url" id="calendarUrl" placeholder="https://..." required>
                    <small style="color: var(--color-text-secondary); font-size: 0.875rem;">
                        Die Ã¶ffentliche iCal-URL des Kalenders (z.B. von Google Calendar, Outlook, etc.)
                    </small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Add Calendar Modal (from location form) -->
    <div id="quickAddCalendarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â• Neuen Kalender hinzufÃ¼gen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="quickAddCalendarForm">
                <div class="form-group">
                    <label for="quickCalendarName">Name <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="text" id="quickCalendarName" placeholder="z.B. Mein Proberaum" required>
                </div>
                <div class="form-group">
                    <label for="quickCalendarIcon">Icon (Emoji)</label>
                    <input type="text" id="quickCalendarIcon" placeholder="ğŸ“…" maxlength="2"
                        style="font-size: 1.5rem; text-align: center;">
                </div>
                <div class="form-group">
                    <label for="quickCalendarUrl">iCal URL <span style="color:red;" title="Pflichtfeld">*</span></label>
                    <input type="url" id="quickCalendarUrl" placeholder="https://..." required>
                    <small style="color: var(--color-text-secondary); font-size: 0.875rem;">
                        Die Ã¶ffentliche iCal-URL des Kalenders
                    </small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Kalender erstellen &
                        verknÃ¼pfen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div id="createEventModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h2 id="eventModalTitle">Neuen Auftritt erstellen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createEventForm">
                <input type="hidden" id="editEventId">

                <div class="form-grid-2">
                    <div class="form-group">
                        <label for="eventBand">Band <span style="color:red;" title="Pflichtfeld">*</span></label>
                        <select id="eventBand" required>
                            <option value="">Band auswÃ¤hlen</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eventTitle">Titel / Anlass <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="text" id="eventTitle" placeholder="z.B. Hochzeit, Firmenfeier..." required>
                    </div>
                    <div class="form-group">
                        <label for="eventDate">Datum und Uhrzeit <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="datetime-local" id="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label for="eventLocation">ğŸ“ Ort / Adresse</label>
                        <input type="text" id="eventLocation" placeholder="Musterstadt, Hauptstr 1">
                    </div>
                </div>

                <div class="form-section-divider"></div>

                <div class="form-group toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="eventShowExtras">
                        <span class="toggle-slider"></span>
                    </label>
                    <label for="eventShowExtras" class="toggle-label">Weitere Infos (Soundcheck,
                        Technik,
                        Event-Infos)</label>
                </div>

                <div id="eventExtrasFields" class="form-optional-section" style="display:none;">
                    <div class="form-group">
                        <label for="eventSoundcheckLocation">ğŸšï¸ Soundcheck Infos</label>
                        <input type="text" id="eventSoundcheckLocation"
                            placeholder="Uhrzeit, konkreter Ort im GebÃ¤ude...">
                    </div>
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="eventInfo">â„¹ï¸ Event-Infos</label>
                            <textarea id="eventInfo" rows="3" placeholder="Ablauf, Ansprechpartner..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="eventTechInfo">ğŸ”§ Technik / PA</label>
                            <textarea id="eventTechInfo" rows="3"
                                placeholder="Was wird benÃ¶tigt? Monitoring?"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section-divider"></div>

                <div class="form-group">
                    <label class="section-title">ğŸ‘¥ Beteiligte Bandmitglieder</label>
                    <div id="eventBandMembers" class="checkbox-list members-grid"></div>
                </div>

                <div class="form-group toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="eventShowGuests">
                        <span class="toggle-slider"></span>
                    </label>
                    <label for="eventShowGuests" class="toggle-label">GÃ¤ste / Aushilfen dabei?</label>
                </div>

                <div id="eventGuestsField" class="form-optional-section" style="display:none;">
                    <div class="form-group">
                        <label for="eventGuests">ğŸ­ GÃ¤steliste</label>
                        <textarea id="eventGuests" rows="3" placeholder="Name (Instrument/Rolle)"></textarea>
                    </div>
                </div>

                <div class="form-section-divider"></div>

                <div class="form-group setlist-section">
                    <div class="section-header-row">
                        <label class="section-title">ğŸµ Setlist</label>
                        <div class="section-actions">
                            <button type="button" id="copyBandSongsBtn" class="btn btn-secondary btn-sm"
                                style="display: none;">
                                ğŸ“‹ Band-Pool
                            </button>
                            <button type="button" id="addEventSongBtn" class="btn btn-secondary btn-sm">
                                + Neuer Song
                            </button>
                        </div>
                    </div>
                    <div id="eventSongsList" class="compact-song-list"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" id="saveEventBtn" class="btn btn-primary">Auftritt
                        speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Song Management Modal -->
    <div id="songModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="song ModalTitle">Song hinzufÃ¼gen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="songForm">
                <input type="hidden" id="songId">
                <input type="hidden" id="songEventId">
                <input type="hidden" id="songBandId">
                <div class="form-group">
                    <label for="songTitle">Titel</label>
                    <input type="text" id="songTitle" required>
                </div>
                <div class="form-group">
                    <label for="songArtist">Interpret</label>
                    <input type="text" id="songArtist" required>
                </div>
                <div class="form-group">
                    <label for="songBPM">BPM</label>
                    <input type="number" id="songBPM" min="1" placeholder="z.B. 120">
                </div>
                <div class="form-group">
                    <label for="songKey">Tonart</label>
                    <select id="songKey">
                        <option value="">â€” Auswahl â€”</option>
                        <!-- Major keys -->
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A">A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                        <!-- Minor keys -->
                        <option value="Cm">Cm</option>
                        <option value="C#m">C#m / Dbm</option>
                        <option value="Dm">Dm</option>
                        <option value="D#m">D#m / Ebm</option>
                        <option value="Em">Em</option>
                        <option value="Fm">Fm</option>
                        <option value="F#m">F#m / Gbm</option>
                        <option value="Gm">Gm</option>
                        <option value="G#m">G#m / Abm</option>
                        <option value="Am">Am</option>
                        <option value="A#m">A#m / Bbm</option>
                        <option value="Bm">Bm</option>
                        <option value="Bm">Bm</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="songOriginalKey">Tonart Original (optional)</label>
                    <select id="songOriginalKey">
                        <option value="">â€” Auswahl â€”</option>
                        <!-- Major keys -->
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A">A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                        <!-- Minor keys -->
                        <option value="Cm">Cm</option>
                        <option value="C#m">C#m / Dbm</option>
                        <option value="Dm">Dm</option>
                        <option value="D#m">D#m / Ebm</option>
                        <option value="Em">Em</option>
                        <option value="Fm">Fm</option>
                        <option value="F#m">F#m / Gbm</option>
                        <option value="Gm">Gm</option>
                        <option value="G#m">G#m / Abm</option>
                        <option value="Am">Am</option>
                        <option value="A#m">A#m / Bbm</option>
                        <option value="Bm">Bm</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="songTimeSignature">Time (optional)</label>
                    <input type="text" id="songTimeSignature" placeholder="z.B. 4/4">
                </div>
                <div class="form-group">
                    <label for="songLanguage">Sprache (optional)</label>
                    <input type="text" id="songLanguage" placeholder="z.B. Deutsch">
                </div>
                <div class="form-group">
                    <label for="songTracks">Tracks (optional)</label>
                    <select id="songTracks">
                        <option value="">â€” Auswahl â€”</option>
                        <option value="yes">Ja</option>
                        <option value="no">Nein</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="songInfo">Songsinfos (optional)</label>
                    <textarea id="songInfo" rows="3" placeholder="ZusÃ¤tzliche Infos zum Song..."></textarea>
                </div>
                <div class="form-group">
                    <label for="songCcli">Songselect CCLI Nummer (optional)</label>
                    <input type="text" id="songCcli" placeholder="CCLI Nummer">
                </div>
                <div class="form-group">
                    <label for="songLeadVocal">Lead Vocal</label>
                    <input type="text" id="songLeadVocal" placeholder="Name des Lead-SÃ¤ngers">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div id="eventDetailsModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h2 id="eventDetailsTitle"></h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="eventDetailsContent"></div>
            </div>
        </div>
    </div>

    <!-- Join Band Modal -->
    <div id="joinBandModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Band beitreten</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="joinBandForm">
                <div class="form-group">
                    <label for="joinBandCode">Band-Beitrittscode</label>
                    <input type="text" id="joinBandCode" maxlength="6" pattern="[A-Za-z0-9]{6}" placeholder="XXXXXX"
                        required style="text-transform: uppercase;">
                    <small style="color: var(--color-text-secondary);">Frag deinen Bandleiter nach dem
                        6-stelligen
                        Code</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Beitreten</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rehearsal Voting Modal -->
    <div id="rehearsalVotingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Jetzt abstimmen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="rehearsalVotingForm">
                <div class="modal-body">
                    <div id="rehearsalVotingContent">
                        <!-- Dates will be injected here -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" id="saveRehearsalVotesBtn" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Absence Management Modal -->
    <div id="absenceModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Meine Abwesenheiten</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Create Absence Section -->
                <div class="section">
                    <h3>Neue Abwesenheit eintragen</h3>
                    <form id="createAbsenceForm">
                        <input type="hidden" id="editAbsenceId">
                        <div class="form-group">
                            <label for="absenceStart">Von (Datum)</label>
                            <input type="date" id="absenceStart" required>
                        </div>
                        <div class="form-group">
                            <label for="absenceEnd">Bis (Datum)</label>
                            <input type="date" id="absenceEnd" required>
                        </div>
                        <div class="form-group">
                            <label for="absenceReason">Grund (optional)</label>
                            <input type="text" id="absenceReason" placeholder="z.B. Urlaub, Krankheit...">
                        </div>
                        <div style="display:flex; gap:0.5rem; align-items:center;">
                            <button type="submit" id="saveAbsenceBtn" class="btn btn-primary">Abwesenheit
                                hinzufÃ¼gen</button>
                            <button type="button" id="cancelEditAbsenceBtn" class="btn cancel"
                                style="display:none;">Abbrechen</button>
                        </div>
                    </form>
                </div>

                <!-- List Absences Section -->
                <div class="section">
                    <h3>Meine eingetragenen Abwesenheiten</h3>
                    <div id="absencesList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create News Modal -->
    <div id="createNewsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>News erstellen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createNewsForm">
                <input type="hidden" id="editNewsId">
                <div class="form-group">
                    <label for="newsTitle">Titel</label>
                    <input type="text" id="newsTitle" required placeholder="z.B. Neue Feature: Abwesenheiten">
                </div>
                <div class="form-group">
                    <label for="newsContent">Inhalt</label>
                    <!-- Rich Text Editor Toolbar -->
                    <div class="rte-toolbar">
                        <button type="button" class="rte-button" data-command="bold" title="Fett (Strg+B)">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="rte-button" data-command="italic" title="Kursiv (Strg+I)">
                            <em>I</em>
                        </button>
                        <button type="button" class="rte-button" data-command="underline"
                            title="Unterstrichen (Strg+U)">
                            <u>U</u>
                        </button>
                        <span class="rte-divider"></span>
                        <button type="button" class="rte-button" data-command="formatBlock" data-value="h3"
                            title="Ãœberschrift 3">
                            H3
                        </button>
                        <button type="button" class="rte-button" data-command="formatBlock" data-value="h4"
                            title="Ãœberschrift 4">
                            H4
                        </button>
                        <button type="button" class="rte-button" data-command="formatBlock" data-value="p"
                            title="Normal">
                            P
                        </button>
                        <span class="rte-divider"></span>
                        <button type="button" class="rte-button" data-command="insertUnorderedList" title="AufzÃ¤hlung">
                            â€¢ List
                        </button>
                        <button type="button" class="rte-button" data-command="insertOrderedList"
                            title="Nummerierte Liste">
                            1. List
                        </button>
                        <span class="rte-divider"></span>
                        <button type="button" class="rte-button" id="rteInsertImageBtn" title="Bild einfÃ¼gen">
                            ğŸ–¼ï¸ Bild
                        </button>
                    </div>
                    <!-- Rich Text Editor Content Area -->
                    <div id="newsContent" class="rte-editor" contenteditable="true" role="textbox"
                        aria-label="News content editor"
                        data-placeholder="Beschreibe das Update oder Feature... Du kannst Text formatieren und Bilder einfÃ¼gen.">
                    </div>
                    <!-- Hidden file input for inline images -->
                    <input type="file" id="rteImageInput" accept="image/*" style="display:none;">
                </div>
                <div class="form-group">
                    <label for="newsImages">Bilder (optional)</label>
                    <input type="file" id="newsImages" accept="image/*" multiple>
                    <div id="newsImagesPreview" style="display:flex; gap:0.5rem; margin-top:0.5rem; flex-wrap:wrap;">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">VerÃ¶ffentlichen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- News Detail Modal -->
    <div id="newsDetailModal" class="modal news-detail-modal">
        <div class="modal-content news-modal-content">
            <button class="modal-close news-modal-close">&times;</button>

            <div id="newsDetailHero" class="news-hero-section">
                <!-- Hero Image injected here -->
            </div>

            <div class="modal-body news-modal-body">
                <div class="news-header-block">
                    <h2 id="newsDetailTitle"></h2>
                    <p id="newsDetailDate"></p>
                </div>

                <div id="newsDetailContent" class="news-content-modern">
                </div>

                <div id="newsDetailImages" class="news-gallery-section">
                    <!-- Remaining images rendered here -->
                </div>
            </div>

            <!-- Update Email Section (only for confirmed rehearsals) -->
            <div id="updateEmailSection"
                style="display: none; margin-top: 1rem; padding: 1rem; background: var(--color-bg-secondary); border-radius: var(--radius-md); border-left: 3px solid var(--color-warning);">
                <h3 style="margin: 0 0 0.5rem 0; font-size: 1rem;">ğŸ“§ Update-Email versenden</h3>
                <div class="checkbox-item" style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="sendUpdateEmail" />
                    <label for="sendUpdateEmail" style="cursor: pointer; margin: 0;">Bandmitglieder Ã¼ber
                        Ã„nderungen informieren</label>
                </div>
            </div>

            <div class="modal-actions news-modal-actions">
                <button type="button" class="btn btn-secondary cancel">SchlieÃŸen</button>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirmDeleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmDeleteTitle">Wirklich lÃ¶schen?</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmDeleteMessage" style="margin: 0; color: var(--color-text-secondary);">
                    MÃ¶chtest du diesen Eintrag wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig
                    gemacht
                    werden.
                </p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn cancel" id="confirmDeleteCancel">Abbrechen</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteConfirm">LÃ¶schen</button>
            </div>
        </div>
    </div>



    <!-- Calendar Event Detail Modal -->
    <div id="calendarEventModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="eventModalTitle">Event Details</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div>
                        <strong style="color: var(--color-text-secondary);">Titel:</strong>
                        <p id="eventModalSummary" style="margin: 0.25rem 0 0 0;"></p>
                    </div>
                    <div>
                        <strong style="color: var(--color-text-secondary);">Zeit:</strong>
                        <p id="eventModalTime" style="margin: 0.25rem 0 0 0;"></p>
                    </div>
                    <div id="eventModalDescriptionContainer" style="display: none;">
                        <strong style="color: var(--color-text-secondary);">Beschreibung:</strong>
                        <p id="eventModalDescription" style="margin: 0.25rem 0 0 0; white-space: pre-wrap;"></p>
                    </div>
                    <div id="eventModalLocationContainer" style="display: none;">
                        <strong style="color: var(--color-text-secondary);">Ort:</strong>
                        <p id="eventModalLocation" style="margin: 0.25rem 0 0 0;"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Image Preview Modal -->
    <div id="profileImageModal" class="modal">
        <div class="modal-content" style="max-width: 600px; text-align: center;">
            <div class="modal-header">
                <h2>Profilbild</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <img id="profileImagePreview" src="" alt="Profilbild"
                    style="max-width: 100%; max-height: 70vh; border-radius: 8px;">
            </div>
        </div>
    </div>

    <!-- PDF Preview Modal -->
    <div id="pdfPreviewModal" class="modal">
        <div class="modal-content pdf-preview-modal-content">
            <div class="modal-header">
                <h2>PDF Vorschau</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body pdf-preview-body">
                <iframe id="pdfPreviewFrame" class="pdf-preview-frame"></iframe>
            </div>
            <div class="modal-footer pdf-preview-footer">
                <button id="pdfPreviewCancel" class="btn btn-secondary">Abbrechen</button>
                <button id="pdfPreviewDownload" class="btn btn-primary">ğŸ“¥ Jetzt herunterladen</button>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Feedback & Bugs</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab-btn active" data-tab="feedback">Feedback</button>
                    <button class="settings-tab-btn" data-tab="bug">Fehler melden</button>
                </div>

                <!-- Feedback Tab -->
                <div id="feedbackTabContent" class="feedback-tab-content active" style="padding: 1rem 0;">
                    <p style="margin-bottom: 1rem;">Ich freue mich Ã¼ber dein Feedback zur App!</p>
                    <form id="feedbackForm">
                        <div class="form-group">
                            <label for="feedbackMessage" style="font-weight: 600;">Deine Nachricht</label>
                            <textarea id="feedbackMessage" rows="5" required
                                placeholder="Was gefÃ¤llt dir, was kann ich besser machen?"
                                style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid var(--color-border); background: var(--color-background); color: var(--color-text);"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">Feedback senden</button>
                    </form>
                </div>

                <!-- Bug Tab -->
                <div id="bugTabContent" class="feedback-tab-content" style="display: none; padding: 1rem 0;">
                    <p style="margin-bottom: 1rem;">Hast du einen Fehler gefunden? Bitte beschreibe ihn hier.</p>
                    <form id="bugReportForm">
                        <div class="form-group">
                            <label for="bugTitle" style="font-weight: 600;">Kurze Beschreibung (Titel)</label>
                            <input type="text" id="bugTitle" required placeholder="z.B. Kalender lÃ¤dt nicht"
                                style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid var(--color-border); background: var(--color-background); color: var(--color-text); margin-bottom: 1rem;">
                        </div>
                        <div class="form-group">
                            <label for="bugDescription" style="font-weight: 600;">Details & Schritte zur
                                Reproduktion</label>
                            <textarea id="bugDescription" rows="5" required
                                placeholder="Was hast du gemacht, bevor der Fehler auftrat?"
                                style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid var(--color-border); background: var(--color-background); color: var(--color-text);"></textarea>
                        </div>
                        <button type="submit" class="btn btn-warning" style="margin-top: 1rem;">Fehler melden</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    </div> <!-- End of mainApp -->

    <!-- Scripts -->

    <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>

    <script src="js/proxy-service.js?v=1.0.0"></script>
    <script src="js/supabase.js?v=1.0.1"></script>
    <script src="js/storage.js?v=1.0.3"></script>
    <script src="js/auth.js?v=1769690040"></script>
    <script src="js/email-service.js?v=1.0.1"></script>
    <script src="js/bands.js?v=1.0.1"></script>
    <script src="js/pdf-generator.js"></script>
    <script src="js/events.js?v=1.0.3"></script>
    <script src="js/rehearsals.js?v=1.0.2"></script>
    <script src="js/statistics.js?v=1.0.4"></script>
    <script src="js/calendar.js?v=1.0.3"></script>
    <script src="js/personal-calendar.js?v=1.0.2"></script>
    <script src="js/churchtools-api.js?v=1.0.1"></script>
    <script src="js/musikpool.js?v=1.0.1"></script>
    <script src="js/ui.js?v=1769690040"></script>
    <script src="js/logger.js?v=1.0.3"></script>
    <script src="js/feedback-service.js?v=1.0.1"></script>
    <script src="js/app.js?v=1769690040"></script>


    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {

                    })
                    .catch((error) => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>



    <!-- Capacitor JS (will be injected by Capacitor on iOS, safe to fail in browser) -->
    <!-- Capacitor Core -->
    <script>
        // Dynamically load capacitor.js only if likely in a native environment to avoid 404s in browser
        if (window.location.protocol === 'file:' || window.location.protocol === 'capacitor:') {
            var script = document.createElement('script');
            script.src = 'capacitor.js';
            script.onerror = function () { console.log('Capacitor not available (running in browser mode)'); };
            document.head.appendChild(script);
        }
    </script>
    <!-- Dynamic Stage Effects for "Sound Check" -->
    <div id="stageEffectsContainer" class="stage-lights-overlay">
        <!-- Reaching Stage Beams -->
        <div class="stage-beam"></div>
        <div class="stage-beam"></div>
        <div class="stage-beam"></div>
        <div class="stage-beam"></div>

        <!-- Floating Music Symbols -->
        <div class="floating-notations">
            <span class="music-note">ğŸµ</span>
            <span class="music-note">ğŸ¸</span>
            <span class="music-note">ğŸ¶</span>
            <span class="music-note">ğŸ¼</span>
            <span class="music-note">ğŸ¹</span>
            <span class="music-note">ğŸ¤</span>
            <span class="music-note">ğŸµ</span>
            <span class="music-note">ğŸ¶</span>
        </div>
    </div>
</body>

</html>