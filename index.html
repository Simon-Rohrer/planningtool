<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Band Management Tool</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Organisiere deine Bandproben effizient">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Band Planning">

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Icons (optional, remove if not yet created) -->
    <!-- <link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192.png"> -->
    <!-- <link rel="icon" type="image/png" sizes="512x512" href="/images/icon-512.png"> -->
    <!-- <link rel="apple-touch-icon" href="/images/icon-192.png"> -->

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/loader.css">
    <link rel="stylesheet" href="css/settings_modal.css">

    <!-- Supabase JS (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- html2canvas for rendering DOM to canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Make jsPDF available as global variable from UMD module
        if (window.jspdf) {
            window.jsPDF = window.jspdf.jsPDF;
        }
    </script>
</head>

<body>
    <!-- Toast Notification (must be directly under body for proper z-index) -->
    <div id="toast" class="toast"></div>

    <!-- Global Loading Overlay -->
    <div class="loader-container" id="globalLoadingOverlay">
        <span class="guitar-spinner">&#127928;</span>
    </div>
    <script>
        // Show loading overlay on first load, hide when app is ready
        window.addEventListener('DOMContentLoaded', function () {
            function hideOverlay() {
                const overlay = document.getElementById('globalLoadingOverlay');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.style.display = 'none', 400);
                }
            }
            // Hide overlay as soon as main app or landing page is visible
            function checkAppReady() {
                const app = document.getElementById('mainApp');
                const landing = document.getElementById('landingPage');
                if ((app && app.style.display !== 'none') || (landing && landing.classList.contains('active'))) {
                    hideOverlay();
                    return true;
                }
                return false;
            }
            // Observe DOM changes to detect when app is shown
            const observer = new MutationObserver(() => {
                if (checkAppReady()) observer.disconnect();
            });
            observer.observe(document.body, { subtree: true, attributes: true, attributeFilter: ['style', 'class'] });
            // Fallback: hide after 3s if not already hidden
            setTimeout(hideOverlay, 3000);
        });
        // Ensure loading overlay stays visible for at least one animation cycle
        (function () {
            const overlay = document.getElementById('globalLoadingOverlay');
            if (!overlay) return;
            let minTime = 2000; // 2s = one animation cycle
            let hideRequested = false;
            let shownAt = Date.now();
            // Patch hide logic if present
            window.hideGlobalLoadingOverlay = function () {
                let elapsed = Date.now() - shownAt;
                if (elapsed >= minTime) {
                    overlay.style.display = 'none';
                } else {
                    hideRequested = true;
                    setTimeout(() => {
                        if (hideRequested) overlay.style.display = 'none';
                    }, minTime - elapsed);
                }
            };
            // Patch show logic if present
            window.showGlobalLoadingOverlay = function () {
                overlay.style.display = 'flex';
                shownAt = Date.now();
                hideRequested = false;
            };
        })();
    </script>
    <!-- Landing Page with Split Layout -->
    <div id="landingPage" class="landing-page active">
        <div class="landing-container">
            <!-- Left Side: Welcome Text -->
            <div class="landing-left" id="heroArea">
                <div class="welcome-content">
                    <div class="welcome-logo">ğŸ¸</div>
                    <h1>Fokus auf die Musik, wir regeln den Rest</h1>
                    <p class="hero-subtitle">Plane Proben, verwalte Gigs und bleib mit deinem Team in Verbindung â€“ alles
                        an einem Ort.</p>

                    <div class="feature-grid">
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ“…</span>
                            <div class="feature-text">
                                <strong>Smart Planning</strong>
                                <p>Termine finden, die fÃ¼r alle passen.</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ¤</span>
                            <div class="feature-text">
                                <strong>Gig Management</strong>
                                <p>Alle Details zu deinen Auftritten im Blick.</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ğŸ“Š</span>
                            <div class="feature-text">
                                <strong>Insights</strong>
                                <p>Statistiken zu deiner Band-AktivitÃ¤t.</p>
                            </div>
                        </div>
                    </div>

                    <div class="hero-actions" style="margin-top: var(--spacing-xl);">
                        <button id="soundCheckBtn" class="btn btn-secondary stage-btn">
                            âš¡ Virtueller Soundcheck
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Side: Login/Register Forms -->
            <div class="landing-right">
                <div class="auth-container">
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">Anmelden</button>
                        <button class="auth-tab" data-tab="register">Registrieren</button>
                    </div>

                    <!-- Login Form -->
                    <form id="loginForm" class="auth-form active">
                        <div class="form-group">
                            <label for="loginUsername">Benutzername oder E-Mail</label>
                            <input type="text" id="loginUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Passwort</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <div class="form-actions-row">
                            <div class="form-check">
                                <input type="checkbox" id="loginRememberMe">
                                <label for="loginRememberMe">Angemeldet bleiben</label>
                            </div>
                            <button type="button" class="btn-link forgot-password">Passwort vergessen?</button>
                        </div>
                        <button type="submit" class="btn btn-primary"
                            style="width: 100%; margin-top: 1rem;">Anmelden</button>
                    </form>

                    <!-- Register Form -->
                    <form id="registerForm" class="auth-form">
                        <div class="form-group">
                            <label for="registerCode">Registrierungscode <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="text" id="registerCode" placeholder="Code eingeben" required>
                            <small style="color: var(--color-text-secondary); font-size: 0.875rem;">Bitte gib den
                                gÃ¼ltigen
                                Registrierungscode ein</small>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="registerFirstName">Vorname <span style="color:red;"
                                        title="Pflichtfeld">*</span></label>
                                <input type="text" id="registerFirstName" required>
                            </div>
                            <div class="form-group">
                                <label for="registerLastName">Nachname <span style="color:red;"
                                        title="Pflichtfeld">*</span></label>
                                <input type="text" id="registerLastName" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="registerEmail">E-Mail <span style="color:red;"
                                        title="Pflichtfeld">*</span></label>
                                <input type="email" id="registerEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="registerUsername">Benutzername <span style="color:red;"
                                        title="Pflichtfeld">*</span></label>
                                <input type="text" id="registerUsername" required>
                                <small id="usernameHint"
                                    style="display:block; margin-top:4px; font-size:0.875rem; color:#888;"></small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="registerInstrument">Instrument (optional)</label>
                            <select id="registerInstrument" class="form-select">
                                <option value="">Kein Instrument</option>
                                <option value="drums">Schlagzeug (ğŸ¥)</option>
                                <option value="bass">Bass (ğŸ¸)</option>
                                <option value="acoustic_guitar">Akustische Gitarre (ğŸ¸)</option>
                                <option value="electric_guitar">Elektrische Gitarre (ğŸ¸)</option>
                                <option value="keyboard">Keyboard (ğŸ¹)</option>
                                <option value="synth">Synth (ğŸ¹)</option>
                                <option value="violin">Geige (ğŸ»)</option>
                                <option value="vocals">Gesang (ğŸ¤)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">Passwort <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="password" id="registerPassword" required>
                            <small id="registerPasswordHint"
                                style="color: var(--color-text-secondary); font-size: 0.875rem; display: block; margin-top: 0.25rem;">Mindestens
                                6 Zeichen erforderlich</small>
                        </div>
                        <div class="form-group">
                            <label for="registerPasswordConfirm">Passwort bestÃ¤tigen <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="password" id="registerPasswordConfirm" required>
                        </div>
                        <div class="form-group">
                            <label for="registerProfileImage">Profilbild (optional, max. 100kb)</label>
                            <input type="file" id="registerProfileImage" accept="image/*">
                            <small style="color: var(--color-text-secondary);">Falls das Bild grÃ¶ÃŸer als 100kb ist, wird
                                es automatisch komprimiert.</small>
                        </div>
                        <button type="submit" class="btn btn-primary">Registrieren</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard (hidden initially) -->
    <div id="mainApp" class="main-app" style="display: none;">

        <!-- Onboarding Modal -->
        <div id="onboardingModal" class="modal">
            <div class="modal-content modal-large onboarding-container">
                <div class="onboarding-header">
                    <h1>Willkommen an Bord! ğŸ¸</h1>
                    <p class="subtitle">SchÃ¶n, dass du da bist! Wie mÃ¶chtest du starten?</p>
                </div>

                <div class="onboarding-cards">
                    <div class="onboarding-card" id="onboardingCreateBandCard">
                        <div class="card-icon">ğŸ—ï¸</div>
                        <h3>Band grÃ¼nden</h3>
                        <p>Werde zum Bandleiter und lade deine Mitmusiker ein.</p>
                        <button id="onboardingCreateBandBtn" class="btn btn-primary">Starten</button>
                    </div>

                    <div class="onboarding-card" id="onboardingJoinBandCard">
                        <div class="card-icon">ğŸ‘‹</div>
                        <h3>Band beitreten</h3>
                        <p>Nutze einen Code, um einer bestehenden Band beizutreten.</p>
                        <button id="onboardingJoinBandBtn" class="btn btn-secondary">Beitreten</button>
                    </div>

                    <div class="onboarding-card" id="onboardingSkipCard">
                        <div class="card-icon">ğŸ‘€</div>
                        <h3>Nur umschauen</h3>
                        <p>Wirf erst mal einen Blick auf die Funktionen im Dashboard.</p>
                        <button id="onboardingSkipBtn" class="btn btn-text">SpÃ¤ter</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="app" class="app-container" style="display: none;">

            <!-- Purple Sidebar (Desktop only) -->
            <aside class="app-sidebar">
                <!-- Sidebar Branding -->
                <div class="sidebar-brand" style="padding: var(--spacing-xl); text-align: center; color: white;">
                    <div style="font-size: 2.5rem; margin-bottom: var(--spacing-xs);">ğŸ¸</div>
                    <div style="font-weight: 800; font-size: 1.25rem; line-height: 1.2;">
                        <div>Band</div>
                        <div style="color: rgba(255,255,255,0.7);">Manager</div>
                    </div>
                </div>

                <!-- Profile Section Removed (now in Header) -->

                <!-- Navigation -->
                <!-- Navigation -->
                <nav class="sidebar-nav">
                    <!-- 1. ÃœBERBLICK -->
                    <div class="nav-group">
                        <button class="nav-item nav-main active" data-view="dashboard">
                            <span class="nav-icon">ğŸ </span>
                            <span class="nav-label">Ãœberblick</span>
                        </button>
                    </div>

                    <!-- 2. BANDS -->
                    <div class="nav-group has-submenu">
                        <button class="nav-item nav-main">
                            <span class="nav-icon">ğŸ‘¥</span>
                            <span class="nav-label">Bands</span>
                            <span class="submenu-arrow">â–¼</span>
                        </button>
                        <div class="nav-submenu">
                            <button class="nav-subitem" data-view="bands">
                                <span class="nav-icon">ğŸ¸</span>
                                <span class="nav-label">Meine Bands</span>
                            </button>
                            <button class="nav-subitem" data-view="musikpool">
                                <span class="nav-icon">ğŸµ</span>
                                <span class="nav-label">Musikerpool</span>
                            </button>
                        </div>
                    </div>

                    <!-- 3. PLANUNG -->
                    <div class="nav-group has-submenu">
                        <button class="nav-item nav-main">
                            <span class="nav-icon">ğŸ—“ï¸</span>
                            <span class="nav-label">Planung</span>
                            <span class="submenu-arrow">â–¼</span>
                        </button>
                        <div class="nav-submenu">
                            <button class="nav-subitem" data-view="kalender">
                                <span class="nav-icon">ğŸ“†</span>
                                <span class="nav-label">Kalender</span>
                            </button>
                            <button class="nav-subitem" data-view="rehearsals">
                                <span class="nav-icon">ğŸ“…</span>
                                <span class="nav-label">Probetermine</span>
                            </button>
                            <button class="nav-subitem" data-view="probeorte">
                                <span class="nav-icon">ğŸ“</span>
                                <span class="nav-label">Probeorte</span>
                            </button>
                        </div>
                    </div>

                    <!-- 4. GIGS -->
                    <div class="nav-group">
                        <button class="nav-item nav-main" data-view="events">
                            <span class="nav-icon">ğŸ¤</span>
                            <span class="nav-label">Gigs</span>
                        </button>
                    </div>

                    <!-- 5. ANALYSE -->
                    <div class="nav-group has-submenu">
                        <button class="nav-item nav-main">
                            <span class="nav-icon">ğŸ“Š</span>
                            <span class="nav-label">Analyse</span>
                            <span class="submenu-arrow">â–¼</span>
                        </button>
                        <div class="nav-submenu">
                            <button class="nav-subitem" data-view="statistics">
                                <span class="nav-icon">ğŸ“ˆ</span>
                                <span class="nav-label">Statistiken</span>
                            </button>
                            <button class="nav-subitem" data-view="news">
                                <span class="nav-icon">ğŸ“°</span>
                                <span class="nav-label">News</span>
                            </button>
                        </div>
                    </div>

                    <!-- 6. EINSTELLUNGEN -->
                    <div class="nav-group" style="margin-top: auto;">
                        <button class="nav-item nav-main" id="openSettingsBtnSidebar">
                            <span class="nav-icon">âš™ï¸</span>
                            <span class="nav-label">Einstellungen</span>
                        </button>
                    </div>

                    <!-- Logout Button moved here for consistent styling -->
                    <div class="nav-group logout-group" style="margin-top: auto;">
                        <button id="sidebarLogoutBtn" class="nav-item nav-main">
                            <span class="nav-icon">ğŸšª</span>
                            <span class="nav-label">Abmelden</span>
                        </button>
                    </div>
                </nav>


            </aside>

            <!-- Main Content Wrapper (right of sidebar on desktop) -->
            <div class="app-main-wrapper">

                <!-- Header -->
                <header class="app-header">
                    <div class="header-content">
                        <h1 class="logo">
                            <span class="logo-emoji">ğŸ¸</span>
                            <span class="logo-text">
                                <span class="logo-part">Band</span>
                                <span class="logo-part">Management</span>
                                <span class="logo-part">Tool</span>
                            </span>
                        </h1>
                        <div class="header-actions">
                            <span id="headerProfileImage" class="profile-avatar"
                                style="display:inline-block;vertical-align:middle;margin-right:0.5em;width:36px;height:36px;border-radius:50%;background:#e5e7eb;overflow:hidden;text-align:center;line-height:36px;font-weight:600;font-size:1.1em;color:#444;"></span>
                            <span id="currentUserName" class="user-name">User</span>
                            <button id="themeToggleHeader" class="btn btn-icon" title="Dark Mode umschalten"
                                style="background: none; border: none; cursor: pointer; font-size: 1.3em; margin-left: 0.5em;">
                                <span id="themeToggleIcon">ğŸŒ™</span>
                            </button>
                            <button id="logoutBtn" class="btn btn-secondary">
                                <img src="images/logout-logo Kopie.jpg" alt="Abmelden" class="icon-img">
                            </button>
                        </div>
                    </div>
                    <!-- Header container for submenu buttons (populated by JS) -->
                    <div id="headerSubmenu" class="header-submenu-nav" aria-live="polite"></div>

                    <!-- Navigation (now inside header on desktop) -->
                    <!-- HIDDEN IN FAVOR OF NEW SIDEBAR -->
                    <nav class="app-nav" id="appNav">
                        <!-- Home (Hauptreiter) -->
                        <div class="nav-group">
                            <button class="nav-item nav-main active" data-view="dashboard">
                                <span class="nav-icon">ğŸ™ï¸</span>
                                <span class="nav-label">Home</span>
                            </button>
                            <div class="nav-submenu">
                                <button class="nav-subitem active" data-view="dashboard">
                                    <span class="nav-icon">ğŸ </span>
                                    <span class="nav-label">Dashboard</span>
                                </button>
                                <button class="nav-subitem" data-view="bands">
                                    <span class="nav-icon">ğŸ¸</span>
                                    <span class="nav-label">Meine Bands</span>
                                </button>
                                <button class="nav-subitem" data-view="musikpool">
                                    <span class="nav-icon">ğŸµ</span>
                                    <span class="nav-label">Musikerpool</span>
                                </button>
                            </div>
                        </div>

                        <!-- Planung (Hauptreiter) -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="rehearsals">
                                <span class="nav-icon">ğŸ—“ï¸</span>
                                <span class="nav-label">Planung</span>
                            </button>
                            <div class="nav-submenu">
                                <button class="nav-subitem" data-view="rehearsals">
                                    <span class="nav-icon">ğŸ“…</span>
                                    <span class="nav-label">Probetermine</span>
                                </button>
                                <button class="nav-subitem" data-view="probeorte">
                                    <span class="nav-icon">ğŸ™ï¸</span>
                                    <span class="nav-label">Probeorte</span>
                                </button>
                                <button class="nav-subitem" data-view="kalender">
                                    <span class="nav-icon">ğŸ“†</span>
                                    <span class="nav-label">Mein Kalender</span>
                                </button>
                            </div>
                        </div>

                        <!-- Gigs -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="events">
                                <span class="nav-icon">ğŸ¸</span>
                                <span class="nav-label">Auftritte</span>
                            </button>
                        </div>

                        <!-- Analyse (Hauptreiter) -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="statistics">
                                <span class="nav-icon">ğŸ“Š</span>
                                <span class="nav-label">Analyse</span>
                            </button>
                            <div class="nav-submenu">
                                <button class="nav-subitem" data-view="statistics">
                                    <span class="nav-icon">ğŸ“Š</span>
                                    <span class="nav-label">Statistiken</span>
                                </button>
                                <button class="nav-subitem" data-view="news">
                                    <span class="nav-icon">ğŸ“°</span>
                                    <span class="nav-label">News & Updates</span>
                                </button>
                            </div>
                        </div>

                        <!-- Settings -->
                        <div class="nav-group">
                            <button class="nav-item nav-main" data-view="settings">
                                <span class="nav-icon">âš™ï¸</span>
                                <span class="nav-label">Settings</span>
                            </button>
                        </div>
                    </nav>
                </header>

                <!-- News Banner (appears when there are unread news) -->
                <div id="newsBanner" class="news-banner" style="display: none;">
                    <div class="news-banner-content">
                        <span class="news-banner-icon">ğŸ“°</span>
                        <div class="news-banner-text">
                            <strong>Neue News verfÃ¼gbar!</strong>
                            <span id="newsBannerMessage">Es gibt ungelesene Updates</span>
                        </div>
                        <button id="newsBannerButton" class="btn btn-sm btn-primary">
                            Mehr Infos
                        </button>
                        <button id="newsBannerClose" class="news-banner-close" title="SchlieÃŸen">
                            Ã—
                        </button>
                    </div>
                </div>

                <!-- Tutorial Suggest Banner (for admins) -->
                <div id="tutorialSuggestBanner" class="news-banner"
                    style="display: none; background: linear-gradient(90deg,#f0f7ff,#e8f4ff); border: 1px solid var(--color-border);">
                    <div class="news-banner-content">
                        <span class="news-banner-icon">ğŸ“</span>
                        <div class="news-banner-text">
                            <strong>Tutorial verfÃ¼gbar</strong>
                            <span id="tutorialBannerMessage">MÃ¶chtest du eine kurze Tour durch die App starten?</span>
                        </div>
                        <button id="tutorialStartBannerBtn" class="btn btn-primary">Tour starten</button>
                        <button id="tutorialDismissBannerBtn" class="news-banner-close" title="SchlieÃŸen">Ã—</button>
                    </div>
                </div>

                <!-- Main Content -->
                <main class="app-main">
                    <!-- Dashboard View -->
                    <div id="dashboardView" class="view active">
                        <div class="view-header">
                            <h2>Dashboard</h2>
                        </div>
                        <!-- Dashboard Hero Section -->
                        <div id="dashboardHero" class="dashboard-hero">
                            <div class="hero-welcome">
                                <h2 class="welcome-text">Hallo <span id="welcomeUserName">Musiker</span>, bereit zum
                                    Rocken? ğŸ¤˜</h2>
                                <p class="hero-subtitle">Hier ist der Ãœberblick fÃ¼r deine musikalische Woche.</p>
                            </div>
                            <div id="nextEventHero" class="next-event-hero-card">
                                <div class="next-event-badge">NÃ¤chster Termin</div>
                                <div id="nextEventContent" class="next-event-content">
                                    <div class="next-event-placeholder">Lade nÃ¤chsten Termin...</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-grid">
                            <div class="dashboard-card stat-card">
                                <div class="card-icon">ğŸ¸</div>
                                <div class="card-content">
                                    <h3>Meine Bands</h3>
                                    <p class="card-stat" id="bandCount">0</p>
                                </div>
                            </div>
                            <div class="dashboard-card stat-card">
                                <div class="card-icon">ğŸ¤</div>
                                <div class="card-content">
                                    <h3>NÃ¤chste Gigs</h3>
                                    <p class="card-stat" id="upcomingEvents">0</p>
                                </div>
                            </div>
                            <div class="dashboard-card stat-card">
                                <div class="card-icon">ğŸ—³ï¸</div>
                                <div class="card-content">
                                    <h3>Votings offen</h3>
                                    <p class="card-stat" id="pendingVotes">0</p>
                                </div>
                            </div>
                            <div class="dashboard-card stat-card">
                                <div class="card-icon">âœ…</div>
                                <div class="card-content">
                                    <h3>BestÃ¤tigt</h3>
                                    <p class="card-stat" id="confirmedRehearsals">0</p>
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard Sections in Bento Layout -->
                        <div class="dashboard-bento-grid">
                            <div class="dashboard-section news-section" id="dashboardNewsSection">
                                <div class="dashboard-section-header">
                                    <h3>ğŸ“° Letzte News</h3>
                                    <div class="section-header-actions">
                                        <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                    </div>
                                </div>
                                <div id="dashboardNewsList" class="dashboard-news-list"></div>
                            </div>

                            <div class="dashboard-section quick-access-section" id="dashboardQuickAccessSection">
                                <div class="dashboard-section-header">
                                    <h3>âš¡ Schnellzugriff</h3>
                                    <div class="section-header-actions">
                                        <button id="editQuickAccessBtn" class="btn btn-icon-sm"
                                            title="Bearbeiten">âœï¸</button>
                                        <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                    </div>
                                </div>
                                <div class="dashboard-quick-links" id="dashboardQuickLinks"></div>
                            </div>

                            <div class="dashboard-section calendar-section" id="dashboardCalendarSection">
                                <div class="dashboard-section-header">
                                    <h3>ğŸ“… Kalender-Abo</h3>
                                    <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                </div>
                                <div class="calendar-sync-card">
                                    <p>Verpasse keinen Termin mehr durch die Kalender-Synchronisation.</p>
                                    <button class="btn btn-primary btn-sm" onclick="App.navigateTo('kalender')">Sync
                                        einrichten</button>
                                </div>
                            </div>

                            <div class="dashboard-section activity-section" id="dashboardActivitySection">
                                <div class="dashboard-section-header">
                                    <h3>âœ¨ AktivitÃ¤ten</h3>
                                    <span class="dashboard-drag-handle" title="Zum Verschieben ziehen">â‰¡</span>
                                </div>
                                <div id="dashboardActivityList" class="dashboard-activity-list"></div>
                            </div>
                        </div>

                        <div class="section">
                            <br>
                            <h3>NÃ¤chste Termine</h3>
                            <div id="upcomingList" class="rehearsal-list"></div>
                        </div>
                    </div>

                    <!-- Bands View -->
                    <div id="bandsView" class="view">
                        <div class="view-header">
                            <h2>Meine Bands</h2>
                            <div class="view-controls">
                                <button id="createBandBtnView" class="btn btn-primary">
                                    + Band erstellen
                                </button>
                                <button id="joinBandBtn" class="btn btn-secondary btn-bands-join-modal">
                                    Band beitreten
                                </button>
                            </div>
                        </div>
                        <div id="bandsList" class="bands-grid"></div>
                    </div>

                    <!-- Events View -->
                    <div id="eventsView" class="view">
                        <div class="view-header">
                            <h2>Auftritte</h2>
                            <div class="view-controls">
                                <select id="eventBandFilter" class="form-select">
                                    <option value="">Alle Bands</option>
                                </select>
                                <button id="createEventBtn" class="btn btn-primary">+ Neuer Auftritt</button>
                            </div>
                        </div>
                        <div id="eventsList" class="events-list"></div>
                    </div>

                    <!-- Rehearsals View -->
                    <div id="rehearsalsView" class="view">
                        <div class="view-header">
                            <h2>Probetermine</h2>
                            <div class="view-controls">
                                <select id="bandFilter" class="form-select">
                                    <option value="">Alle Bands</option>
                                </select>
                                <button id="createRehearsalBtn" class="btn btn-primary">+ Neuer Probetermin</button>
                            </div>
                        </div>
                        <div id="rehearsalsListPendingHeader" class="rehearsal-section-header">
                            <h3>ğŸ‘‹ Offene Abstimmungen</h3>
                        </div>
                        <div id="rehearsalsListPending" class="rehearsal-list" style="margin-bottom: 2rem;"></div>

                        <div id="rehearsalsListVotedHeader" class="rehearsal-section-header">
                            <h3>âœ… Bereits abgestimmt</h3>
                        </div>
                        <div id="rehearsalsListVoted" class="rehearsal-list"></div>

                        <div id="rehearsalsListResolvedHeader" class="rehearsal-section-header" style="margin-top: 2rem; opacity: 0.8;">
                            <h3>ğŸ Erledigte Proben</h3>
                        </div>
                        <div id="rehearsalsListResolved" class="rehearsal-list resolved-list" style="opacity: 0.8;"></div>
                    </div>

                    <!-- Statistics View -->
                    <div id="statisticsView" class="view">
                        <div class="view-header">
                            <h2>Statistiken</h2>
                            <div style="display:flex; gap: 0.5rem; align-items:center;">
                                <select id="statsBandSelect" class="form-select">
                                    <option value="">Band auswÃ¤hlen</option>
                                </select>
                                <select id="statsRehearsalSelect" class="form-select">
                                    <option value="">Probetermin auswÃ¤hlen</option>
                                </select>
                            </div>
                        </div>
                        <div id="statisticsContent" class="statistics-content">
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ“Š</div>
                                <p>WÃ¤hle einen Probetermin aus, um die Statistiken zu sehen</p>
                            </div>
                        </div>
                    </div>

                    <!-- News & Updates View -->
                    <div id="newsView" class="view">
                        <div class="view-header">
                            <h2>News & Updates</h2>
                            <div class="view-controls">
                                <a href="#" id="donateBtn" class="btn btn-secondary"
                                    style="display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none;">
                                    ğŸ’– Spenden
                                </a>
                                <button id="createNewsBtn" class="btn btn-primary" style="display: none;">+ News
                                    erstellen</button>
                            </div>
                        </div>
                        <div id="newsContainer" class="news-content">
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ“°</div>
                                <p>Noch keine News oder Updates vorhanden.</p>
                                <p>Hier wirst du auf dem laufenden gehalten.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Probeorte View -->
                    <div id="probeorteView" class="view">
                        <div class="view-header">
                            <h2>JMS Probeorte Kalender</h2>
                        </div>

                        <!-- Submenu for calendar selection -->
                        <div class="calendar-submenu">
                            <button id="probeorteBtn" class="calendar-tab active" data-calendar="tonstudio">
                                ğŸ™ï¸ Tonstudio
                            </button>
                            <button id="probeorteBtn" class="calendar-tab" data-calendar="festhalle">
                                ğŸ›ï¸ JMS Festhalle
                            </button>
                            <button id="probeorteBtn" class="calendar-tab" data-calendar="ankersaal">
                                âš“ Ankersaal
                            </button>
                            <!-- refresh button removed per request -->
                        </div>

                        <div class="section">
                            <!-- Tonstudio Calendar -->
                            <div id="tonstudioCalendar" class="calendar-container active">
                                <div id="tonstudioEventsContainer" style="min-height: 400px;">
                                    <!-- Events will be rendered here -->
                                </div>
                            </div>

                            <!-- Festhalle Calendar -->
                            <div id="festhalleCalendar" class="calendar-container">
                                <div id="festhalleEventsContainer" style="min-height: 400px;">
                                    <!-- Events will be rendered here -->
                                </div>
                            </div>

                            <!-- Ankersaal Calendar -->
                            <div id="ankersaalCalendar" class="calendar-container">
                                <div id="ankersaalEventsContainer" style="min-height: 400px;">
                                    <!-- Events will be rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kalender View -->
                    <div id="kalenderView" class="view">
                        <div class="view-header">
                            <h2>ğŸ“… Mein Kalender</h2>
                        </div>
                        <div class="section">
                            <div id="personalCalendarContainer">
                                <!-- Personal calendar will be rendered here -->
                            </div>
                            <div>
                                <br>
                                <span style="font-size:0.9rem; color:var(--color-text-secondary); line-height:1.4;">
                                    Abonniere jetzt deinen Kalender in deinem Apple- oder Samsung-Kalender, um nichts
                                    mehr
                                    zu verpassen!
                                    <br></span>
                                <button id="subscribeCalendarBtn" class="btn btn-secondary"
                                    style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                    ğŸ”— Kalender abonnieren
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Musikerpool View -->
                    <div id="musikpoolView" class="view">
                        <div class="view-header">
                            <h2>Musikerpool</h2>
                        </div>

                        <!-- Eigene Mitglieder Section -->
                        <div class="section">
                            <div class="section-header">
                                <h3>Eigene Mitglieder</h3>
                                <button id="addOwnMemberBtn" class="btn btn-primary"
                                    style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                    â• Mitglied hinzufÃ¼gen
                                </button>
                            </div>
                            <div id="ownMembersContainer">
                                <div class="empty-state">
                                    <div class="empty-icon">ğŸ‘¥</div>
                                    <p>Noch keine eigenen Mitglieder angelegt</p>
                                    <p
                                        style="color: var(--color-text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                                        Hier kÃ¶nnen Sie eigene Musiker und Kontakte hinzufÃ¼gen.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- ChurchTools Pool Section -->
                        <div class="section">
                            <h3>ChurchTools Musikpool</h3>
                            <button id="refreshMusikpoolBtn" class="btn btn-secondary"
                                style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                ğŸ”„ Aktualisieren
                            </button>
                            <div id="musikpoolContainer">
                                <!-- ChurchTools members will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Settings View -->
                    <!-- Settings View Removed -->
                </main>
            </div> <!-- End app-main-wrapper -->
        </div> <!-- End app -->

        <!-- Modal: Schnellzugriff bearbeiten -->
        <div id="quickAccessModal" class="modal">
            <div class="modal-content" style="max-width: 420px;">
                <h2>Schnellzugriff bearbeiten</h2>
                <form id="quickAccessForm">
                    <div id="quickAccessOptions"
                        style="display: flex; flex-direction: column; gap: 0.7rem; margin: 1rem 0;"></div>
                    <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                        <button type="button" class="btn btn-secondary" id="cancelQuickAccessBtn">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Absences Content (for inclusion in Settings) -->
        <div id="absencesSettingsContent" style="display: none;">
            <!-- Create Absence Section -->
            <div class="absence-form-container">
                <h3>Neue Abwesenheit eintragen</h3>
                <form id="createAbsenceForm">
                    <input type="hidden" id="editAbsenceId">
                    <div class="form-group">
                        <label for="absenceStart">Von (Datum)</label>
                        <input type="date" id="absenceStart" required>
                    </div>
                    <div class="form-group">
                        <label for="absenceEnd">Bis (Datum)</label>
                        <input type="date" id="absenceEnd" required>
                    </div>
                    <div class="form-group">
                        <label for="absenceReason">Grund (optional)</label>
                        <input type="text" id="absenceReason" placeholder="z.B. Urlaub, Krankheit...">
                    </div>
                    <div style="display:flex; gap:0.5rem; align-items:center;">
                        <button type="submit" id="saveAbsenceBtn" class="btn btn-primary">Abwesenheit
                            hinzufÃ¼gen</button>
                        <button type="button" id="cancelEditAbsenceBtn" class="btn btn-secondary"
                            style="display:none;">Abbrechen</button>
                    </div>
                </form>
            </div>

            <!-- List Absences Section -->
            <div class="section">
                <h3>Meine eingetragenen Abwesenheiten</h3>
                <div id="absencesList"></div>
            </div>
        </div>

        <!-- Hidden container end -->
        <div style="display: none;">
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="settings-tabs">
                        <button id="settingsTabProfile" class="settings-tab-btn active"
                            data-tab="profile">Profil</button>
                        <button id="settingsTabAbsences" class="settings-tab-btn"
                            data-tab="absences">Abwesenheiten</button>
                        <button id="settingsTabLocations" class="settings-tab-btn"
                            data-tab="locations">Probeorte</button>
                        <button id="settingsTabBands" class="settings-tab-btn" data-tab="bands">Bandmanagement</button>
                        <button id="settingsTabUsers" class="settings-tab-btn" data-tab="users"
                            style="display: none;">Benutzerverwaltung</button>
                    </div>

                    <!-- Profile Tab -->
                    <div id="profileSettingsTab" class="settings-tab-content active">
                        <div class="section">
                            <h3>Mein Profil bearbeiten</h3>
                            <form id="updateProfileForm">
                                <div class="form-group" style="display:flex;align-items:center;gap:1.5rem;">
                                    <div id="profileImageSettingsContainer"
                                        style="display:flex;flex-direction:column;align-items:center;gap:0.5rem;">
                                        <!-- Profilbild/Initialen werden per JS gerendert -->
                                    </div>
                                    <div style="flex:1;">
                                        <label for="profileImageInput" style="font-weight:600;">Profilbild
                                            Ã¤ndern</label>
                                        <input type="file" id="profileImageInput" accept="image/*"
                                            style="margin-bottom:0.5rem;">
                                        <button type="button" id="deleteProfileImageBtn" class="btn btn-danger btn-sm"
                                            style="margin-top:0.2rem;">Profilbild
                                            entfernen</button>
                                        <small style="display:block;color:#888;">Max. 100kb. GrÃ¶ÃŸere Bilder werden
                                            komprimiert.</small>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="profileFirstName">Vorname</label>
                                    <input type="text" id="profileFirstName" required>
                                </div>
                                <div class="form-group">
                                    <label for="profileLastName">Nachname</label>
                                    <input type="text" id="profileLastName" required>
                                </div>
                                <div class="form-group">
                                    <label for="profileUsername">Benutzername</label>
                                    <input type="text" id="profileUsername" required>
                                </div>
                                <div class="form-group">
                                    <label for="profileEmail">E-Mail</label>
                                    <input type="email" id="profileEmail" required>
                                </div>
                                <div class="form-group">
                                    <label for="profileInstrument">Instrument</label>
                                    <select id="profileInstrument" class="form-select">
                                        <option value="">Kein Instrument</option>
                                        <option value="drums">Schlagzeug (ğŸ¥)</option>
                                        <option value="bass">Bass (ğŸ¸)</option>
                                        <option value="acoustic_guitar">Akustische Gitarre (ğŸ¸)</option>
                                        <option value="electric_guitar">Elektrische Gitarre (ğŸ¸)</option>
                                        <option value="keyboard">Keyboard (ğŸ¹)</option>
                                        <option value="synth">Synth (ğŸ¹)</option>
                                        <option value="violin">Geige (ğŸ»)</option>
                                        <option value="vocals">Gesang (ğŸ¤)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="profilePassword">Neues Passwort (leer lassen fÃ¼r keine
                                        Ã„nderung)</label>
                                    <input type="password" id="profilePassword" placeholder="Neues Passwort">
                                </div>
                                <div class="form-group" id="profilePasswordConfirmGroup" style="display: none;">
                                    <label for="profilePasswordConfirm">Passwort bestÃ¤tigen</label>
                                    <input type="password" id="profilePasswordConfirm"
                                        placeholder="Passwort wiederholen">
                                </div>
                                <button type="submit" class="btn btn-primary">Speichern</button>
                            </form>
                            <!-- Admin: Tutorial anzeigen / testen (sichtbar nur fÃ¼r Admins, wird per JS gesteuert) -->
                            <div id="adminTutorialSection" style="margin-top: 1rem; display: none;">
                                <h4>Tutorial</h4>
                                <p style="color: var(--color-text-secondary); margin-top: 0.25rem;">Als Admin kannst
                                    du
                                    das Onboarding/Tutorial anzeigen und testen.</p>
                                <button id="adminShowTutorialBtn" class="btn btn-secondary">Tutorial anzeigen /
                                    testen</button>
                            </div>
                            <div class="section" style="margin-top: 1rem;">
                                <!-- Account lÃ¶schen Button -->
                                <button id="deleteAccountBtn" class="btn btn-danger" style="margin-top:2rem;">Account
                                    lÃ¶schen</button>
                            </div>
                            <div class="section" style="margin-top: 1rem;">
                                <h3>Spenden-Link</h3>
                                <div class="form-group">
                                    <label for="donateLink">PayPal-Link</label>
                                    <input type="url" id="donateLink" placeholder="https://paypal.me/deinusername"
                                        value="">
                                    <small
                                        style="color: var(--color-text-secondary); display: block; margin-top: 0.5rem;">
                                        Gib hier deinen PayPal.me-Link ein. Er wird im News-Bereich angezeigt.
                                    </small>
                                </div>
                                <button id="saveDonateLink" class="btn btn-primary">Spenden-Link speichern</button>
                            </div>
                        </div>
                    </div>

                    <!-- Absences Tab -->
                    <div id="absencesSettingsTab" class="settings-tab-content">
                        <!-- Create Absence Section -->
                        <div class="section">
                            <h3>Neue Abwesenheit eintragen</h3>
                            <form id="createAbsenceFormSettings">
                                <input type="hidden" id="editAbsenceIdSettings">
                                <div class="form-group">
                                    <label for="absenceStartSettings">Von (Datum)</label>
                                    <input type="date" id="absenceStartSettings" required>
                                </div>
                                <div class="form-group">
                                    <label for="absenceEndSettings">Bis (Datum)</label>
                                    <input type="date" id="absenceEndSettings" required>
                                </div>
                                <div class="form-group">
                                    <label for="absenceReasonSettings">Grund (optional)</label>
                                    <input type="text" id="absenceReasonSettings"
                                        placeholder="z.B. Urlaub, Krankheit...">
                                </div>
                                <div style="display:flex; gap:0.5rem; align-items:center;">
                                    <button type="submit" id="saveAbsenceBtnSettings"
                                        class="btn btn-primary">Abwesenheit
                                        hinzufÃ¼gen</button>
                                    <button type="button" id="cancelEditAbsenceBtnSettings" class="btn cancel"
                                        style="display:none;">Abbrechen</button>
                                </div>
                            </form>
                        </div>

                        <!-- List Absences Section -->
                        <div class="section">
                            <h3>Meine eingetragenen Abwesenheiten</h3>
                            <div id="absencesListSettings"></div>
                        </div>
                    </div>

                    <!-- Locations Tab -->
                    <div id="locationsSettingsTab" class="settings-tab-content">
                        <div class="section">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div>
                                    <h3>Kalender verwalten</h3>
                                    <p class="help-text">Verwalte iCal-Kalender fÃ¼r die VerfÃ¼gbarkeitsprÃ¼fung von
                                        Probeorten</p>
                                </div>
                                <button id="addCalendarBtn" class="btn btn-primary" style="white-space: nowrap;">
                                    â• Neuen Kalender hinzufÃ¼gen
                                </button>
                            </div>
                            <div id="calendarsList" class="calendars-list"></div>
                        </div>
                        <div class="section">
                            <h3>Neuen Probeort hinzufÃ¼gen</h3>
                            <form id="createLocationForm" class="inline-form">
                                <div class="form-group">
                                    <label for="newLocationName" class="sr-only">Name</label>
                                    <input type="text" id="newLocationName" placeholder="Name (z.B. Proberaum A)"
                                        required>

                                    <label for="newLocationAddress" class="sr-only">Adresse</label>
                                    <input type="text" id="newLocationAddress" placeholder="Adresse (Optional)">
                                </div>
                                <div class="form-group">
                                    <label for="newLocationLinkedCalendar">Mit Kalender verknÃ¼pfen:</label>
                                    <select id="newLocationLinkedCalendar" class="form-select">
                                        <option value="">Nicht verknÃ¼pft</option>
                                        <option value="tonstudio">ğŸ™ï¸ Tonstudio</option>
                                        <option value="festhalle">ğŸ›ï¸ JMS Festhalle</option>
                                        <option value="ankersaal">âš“ Ankersaal</option>
                                    </select>
                                    <p class="help-text">WÃ¤hle einen Kalender, um bei der Probe-Erstellung die
                                        VerfÃ¼gbarkeit
                                        zu prÃ¼fen.</p>
                                </div>
                                <button type="submit" class="btn btn-primary">HinzufÃ¼gen</button>
                            </form>
                        </div>
                        <div class="section">
                            <h3>Vorhandene Probeorte</h3>
                            <div id="locationsList" class="locations-list"></div>
                        </div>
                    </div>

                    <!-- Bands Management Tab -->
                    <div id="bandsSettingsTab" class="settings-tab-content">
                        <div class="section">
                            <div>
                                <h3>Alle Bands</h3>
                                <button id="createBandBtn" class="btn btn-primary">+ Neue Band erstellen</button>

                            </div>
                            <div id="allBandsList" class="bands-management-list"></div>
                        </div>
                    </div>

                    <!-- User Management Tab (Admin Only) -->
                    <div id="usersSettingsTab" class="settings-tab-content">
                        <div class="section">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div>
                                    <h3>Benutzerverwaltung</h3>
                                    <p class="help-text">Verwalte alle registrierten Benutzer</p>
                                </div>
                                <button id="addUserBtn" class="btn btn-primary" style="white-space: nowrap;">
                                    â• Mitglied hinzufÃ¼gen
                                </button>
                            </div>
                            <div id="usersList" class="users-list"></div>
                        </div>
                    </div>

                    <!-- Supabase Settings Tab -->
                    <div id="supabaseSettingsTab" class="settings-tab-content">
                        <div class="section">
                            <h3>Supabase Konfiguration</h3>
                            <form id="supabaseSettingsForm">
                                <div class="form-group">
                                    <label for="supabaseUrl">Supabase URL</label>
                                    <input type="url" id="supabaseUrl" placeholder="https://your-project.supabase.co">
                                </div>
                                <div class="form-group">
                                    <label for="supabaseAnonKey">Supabase Anon Key</label>
                                    <input type="text" id="supabaseAnonKey" placeholder="ey...">
                                </div>
                                <small style="color: var(--color-text-secondary);">Diese Daten werden lokal
                                    gespeichert
                                    und
                                    fÃ¼r die Datenbankverbindung genutzt.</small>
                                <div class="modal-actions" style="margin-top: 0.5rem;">
                                    <button type="submit" class="btn btn-primary">Speichern</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tutorial Overlay (step-by-step) -->
        <div id="tutorialOverlay" class="tour-overlay" style="display:none;">
            <div id="tourHighlight" class="tour-highlight" aria-hidden="true"></div>
            <div id="tourTooltip" class="tour-tooltip" role="dialog" aria-modal="true">
                <div id="tourTooltipContent">
                    <h3 id="tourTitle">Tutorial</h3>
                    <p id="tourBody">Schritt</p>
                    <div class="tour-controls"
                        style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem;">
                        <button id="tourPrevBtn" class="btn">ZurÃ¼ck</button>
                        <button id="tourNextBtn" class="btn btn-primary">Weiter</button>
                        <button id="tourEndBtn" class="btn">Beenden</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Band Modal -->
        <div id="createBandModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Neue Band erstellen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="createBandForm">
                    <div class="form-group">
                        <label for="bandName">Bandname</label>
                        <input type="text" id="bandName" required>
                    </div>
                    <div class="form-group">
                        <label for="bandDescription">Beschreibung</label>
                        <textarea id="bandDescription" rows="3"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Band erstellen</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Band Modal -->
        <div id="editBandModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Band bearbeiten</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="editBandForm">
                    <input type="hidden" id="editBandId">
                    <div class="form-group">
                        <label for="editBandName">Bandname</label>
                        <input type="text" id="editBandName" required>
                    </div>
                    <div class="form-group">
                        <label for="editBandDescription">Beschreibung</label>
                        <textarea id="editBandDescription" rows="3"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Location Modal -->
        <div id="editLocationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Probeort bearbeiten</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="editLocationForm">
                    <input type="hidden" id="editLocationId">
                    <div class="form-group">
                        <label for="editLocationName">Name</label>
                        <input type="text" id="editLocationName" required>
                    </div>
                    <div class="form-group">
                        <label for="editLocationAddress">Adresse</label>
                        <input type="text" id="editLocationAddress">
                    </div>
                    <div class="form-group">
                        <label for="editLocationLinkedCalendar">Mit Kalender verknÃ¼pfen:</label>
                        <select id="editLocationLinkedCalendar" class="form-select">
                            <option value="">Nicht verknÃ¼pft</option>
                            <option value="tonstudio">ğŸ™ï¸ Tonstudio</option>
                            <option value="festhalle">ğŸ›ï¸ JMS Festhalle</option>
                            <option value="ankersaal">âš“ Ankersaal</option>
                        </select>
                        <p class="help-text">WÃ¤hle einen Kalender, um bei der Probe-Erstellung die VerfÃ¼gbarkeit zu
                            prÃ¼fen.
                        </p>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Band Details Modal -->
        <div id="bandDetailsModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="bandDetailsName"></h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="members">Mitglieder</button>
                        <button class="tab-btn" data-tab="setlist">Setlist</button>
                        <!-- Abwesenheiten-Tab (sichtbar fÃ¼r Leiter/Co-Leiter) -->
                        <button class="tab-btn" data-tab="absences" id="bandAbsencesTabBtn"
                            style="display: none;">Abwesenheiten</button>
                        <button class="tab-btn" data-tab="settings">Settings</button>
                    </div>

                    <!-- Members Tab -->
                    <div id="membersTab" class="tab-content active">
                        <div class="section">
                            <div class="section-header">
                                <h3>Bandmitglieder</h3>
                                <button id="addMemberBtn" class="btn btn-primary btn-sm">+ Mitglied
                                    hinzufÃ¼gen</button>
                            </div>
                            <div id="membersList" class="members-list"></div>
                        </div>
                    </div>

                    <!-- Setlist Tab -->
                    <div id="setlistTab" class="tab-content">
                        <div class="section">
                            <div class="section-header">
                                <h3>Songs</h3>
                                <button id="addBandSongBtn" class="btn btn-primary btn-sm">+ Song
                                    hinzufÃ¼gen</button>
                            </div>
                            <div id="bandSongsList"></div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="settingsTab" class="tab-content">
                        <div class="section" id="bandSettingsSection">
                            <h3>Band-Einstellungen</h3>
                            <div class="settings-actions">
                                <div style="margin-bottom:0.5em;color:#b91c1c;font-weight:bold;; font-size: smaller;">
                                    Achtung: Beim LÃ¶schen werden alle zugehÃ¶rigen Songs, Probetermine und Auftritte
                                    <u>unwiderruflich</u> entfernt!
                                </div>
                                <button id="deleteBandBtn" class="btn btn-danger" style="width: 150px;">Band
                                    lÃ¶schen</button>
                            </div>
                        </div>
                    </div>

                    <!-- Absences Tab (for leaders/co-leaders) -->
                    <div id="absencesTab" class="tab-content">
                        <div class="section">
                            <h3>Abwesenheiten der Mitglieder</h3>
                            <div id="bandAbsencesList">Keine Abwesenheiten vorhanden.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Member Modal -->
        <div id="addMemberModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Mitglied hinzufÃ¼gen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="addMemberForm">
                    <div class="form-group">
                        <label for="memberUsername">Benutzername</label>
                        <input type="text" id="memberUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="memberRole">Rolle</label>
                        <select id="memberRole" required>
                            <option value="member">Mitglied</option>
                            <option value="co-leader">Co-Leiter</option>
                            <option value="leader">Leiter</option>
                        </select>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">HinzufÃ¼gen</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add User Modal (Admin Only) -->
        <div id="addUserModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Neues Mitglied anlegen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUserFirstName">Vorname <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="text" id="newUserFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserLastName">Nachname <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="text" id="newUserLastName" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserEmail">E-Mail <span style="color:red;" title="Pflichtfeld">*</span></label>
                        <input type="email" id="newUserEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserUsername">Benutzername <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="text" id="newUserUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="newUserPassword">Passwort <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="password" id="newUserPassword" required minlength="6">
                        <small style="color: var(--color-text-secondary); font-size: 0.875rem;">Mindestens 6
                            Zeichen</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="newUserIsAdmin">
                            Als Admin anlegen
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Mitglied anlegen</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Create Rehearsal Modal -->
        <div id="createRehearsalModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="rehearsalModalTitle">Neuen Probetermin vorschlagen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="createRehearsalForm">
                    <input type="hidden" id="editRehearsalId">
                    <div class="form-group">
                        <label for="rehearsalBand">Band <span style="color:red;" title="Pflichtfeld">*</span></label>
                        <select id="rehearsalBand" required>
                            <option value="">Band auswÃ¤hlen</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rehearsalTitle">Titel <span style="color:red;" title="Pflichtfeld">*</span></label>
                        <input type="text" id="rehearsalTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="rehearsalLocation">Ort (Optional)</label>
                        <select id="rehearsalLocation">
                            <option value="">Kein Ort ausgewÃ¤hlt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rehearsalDescription">Beschreibung</label>
                        <textarea id="rehearsalDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="rehearsalEvent">Zugewiesener Auftritt (Optional)</label>
                        <select id="rehearsalEvent">
                            <option value="">Kein Auftritt ausgewÃ¤hlt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>TerminvorschlÃ¤ge</label>
                        <div id="dateProposals" class="date-proposals">
                            <div class="date-proposal-item" data-confirmed="false">
                                <div class="date-time-range">
                                    <input type="date" class="date-input-date" id="dateInputDate">
                                    <input type="time" class="date-input-start" id="dateInputStart">
                                    <span class="time-separator">bis</span>
                                    <input type="time" class="date-input-end" id="dateInputEnd">
                                </div>
                                <span class="date-availability" style="margin-left:8px"></span>
                                <button type="button" class="btn btn-sm confirm-proposal-btn">âœ“ BestÃ¤tigen</button>
                                <button type="button" class="btn-icon remove-date" disabled>ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <button type="button" id="addDateBtn" class="btn btn-secondary btn-sm">+ Weiteren Termin
                            hinzufÃ¼gen</button>
                    </div>
                    <div class="form-group checkbox-group" id="notifyMembersGroup" style="display: none;">
                        <div class="checkbox-item">
                            <input type="checkbox" id="notifyMembersOnUpdate">
                            <label for="notifyMembersOnUpdate">Update-E-Mail an alle Beteiligten senden</label>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="button" class="btn btn-danger" id="deleteRehearsalBtn"
                            style="display:none; margin-right: auto;">ğŸ—‘ï¸ LÃ¶schen</button>
                        <button type="submit" class="btn btn-primary" id="saveRehearsalBtn">Vorschlag
                            erstellen</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Rehearsal Details Modal -->
        <div id="rehearsalDetailsModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="rehearsalDetailsTitle"></h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="rehearsalDetailsContent"></div>
                </div>
            </div>
        </div>

        <!-- Confirm Rehearsal Modal -->
        <!-- Time Suggestion Modal -->
        <div id="timeSuggestionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Uhrzeit vorschlagen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="suggestTimeRehearsalId">
                    <input type="hidden" id="suggestTimeDateIndex">

                    <div class="form-group">
                        <label for="suggestedTimeInput">Welche Uhrzeit wÃ¼rdest du vorschlagen?</label>
                        <input type="time" id="suggestedTimeInput" class="form-control" required>
                        <small class="help-text">WÃ¤hle eine Uhrzeit aus, die besser fÃ¼r dich passt</small>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="button" id="deleteTimeSuggestionBtn" class="btn btn-secondary"
                            style="display: none;">ğŸ—‘ï¸ Vorschlag lÃ¶schen</button>
                        <button type="button" id="saveTimeSuggestionBtn" class="btn btn-primary">ğŸ’¾
                            Speichern</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Rehearsal Modal -->
        <div id="confirmRehearsalModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Probe bestÃ¤tigen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="confirmRehearsalId">
                    <input type="hidden" id="confirmDateIndex">

                    <div class="section">
                        <h3>Probendetails bearbeiten</h3>
                        <div class="form-group">
                            <label for="confirmRehearsalTitle">Titel <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="text" id="confirmRehearsalTitle" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmRehearsalDescription">Beschreibung (optional)</label>
                            <textarea id="confirmRehearsalDescription" class="form-control" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="confirmRehearsalStartTime">Von (Start) <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="datetime-local" id="confirmRehearsalStartTime" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmRehearsalEndTime">Bis (Ende) <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="datetime-local" id="confirmRehearsalEndTime" class="form-control" required>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Probeort auswÃ¤hlen</h3>
                        <select id="confirmRehearsalLocation" class="form-select">
                            <option value="">Kein Ort ausgewÃ¤hlt</option>
                        </select>
                    </div>

                    <div class="section">
                        <h3>Bandmitglieder benachrichtigen</h3>
                        <p class="help-text">WÃ¤hle aus, welche Bandmitglieder eine BestÃ¤tigungs-E-Mail erhalten
                            sollen:
                        </p>
                        <div id="confirmMembersList" class="confirm-members-list"></div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="button" id="sendConfirmationBtn" class="btn btn-primary">âœ… Probe bestÃ¤tigen &
                            E-Mail
                            senden</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location Conflict Warning Modal -->
        <div id="locationConflictModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>âš ï¸ Probeort belegt</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="margin-bottom: 1rem;">
                        <strong>Der gewÃ¤hlte Probeort ist zu dieser Zeit bereits belegt!</strong>
                    </p>

                    <div id="conflictDetails" class="conflict-details"></div>

                    <p style="margin-top: 1rem; color: var(--color-text-secondary);">
                        MÃ¶chtest du trotzdem fortfahren?
                    </p>

                    <div class="modal-actions">
                        <button type="button" class="btn cancel" id="abortConfirmationBtn">Abbrechen</button>
                        <button type="button" class="btn btn-primary" id="proceedAnywayBtn">Trotzdem
                            fortfahren</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Calendar Modal -->
        <div id="calendarModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="calendarModalTitle">Neuen Kalender hinzufÃ¼gen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="calendarForm">
                    <input type="hidden" id="editCalendarId">
                    <div class="form-group">
                        <label for="calendarName">Name <span style="color:red;" title="Pflichtfeld">*</span></label>
                        <input type="text" id="calendarName" placeholder="z.B. Mein Proberaum" required>
                    </div>
                    <div class="form-group">
                        <label for="calendarIcon">Icon (Emoji)</label>
                        <input type="text" id="calendarIcon" placeholder="ğŸ“…" maxlength="2"
                            style="font-size: 1.5rem; text-align: center;">
                        <small style="color: var(--color-text-secondary); font-size: 0.875rem;">
                            Optional: Ein Emoji zur visuellen Kennzeichnung
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="calendarUrl">iCal URL <span style="color:red;" title="Pflichtfeld">*</span></label>
                        <input type="url" id="calendarUrl" placeholder="https://..." required>
                        <small style="color: var(--color-text-secondary); font-size: 0.875rem;">
                            Die Ã¶ffentliche iCal-URL des Kalenders (z.B. von Google Calendar, Outlook, etc.)
                        </small>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Add Calendar Modal (from location form) -->
        <div id="quickAddCalendarModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>â• Neuen Kalender hinzufÃ¼gen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="quickAddCalendarForm">
                    <div class="form-group">
                        <label for="quickCalendarName">Name <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="text" id="quickCalendarName" placeholder="z.B. Mein Proberaum" required>
                    </div>
                    <div class="form-group">
                        <label for="quickCalendarIcon">Icon (Emoji)</label>
                        <input type="text" id="quickCalendarIcon" placeholder="ğŸ“…" maxlength="2"
                            style="font-size: 1.5rem; text-align: center;">
                    </div>
                    <div class="form-group">
                        <label for="quickCalendarUrl">iCal URL <span style="color:red;"
                                title="Pflichtfeld">*</span></label>
                        <input type="url" id="quickCalendarUrl" placeholder="https://..." required>
                        <small style="color: var(--color-text-secondary); font-size: 0.875rem;">
                            Die Ã¶ffentliche iCal-URL des Kalenders
                        </small>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Kalender erstellen & verknÃ¼pfen</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Create Event Modal -->
        <div id="createEventModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="eventModalTitle">Neuen Auftritt erstellen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="createEventForm">
                    <input type="hidden" id="editEventId">

                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="eventBand">Band <span style="color:red;" title="Pflichtfeld">*</span></label>
                            <select id="eventBand" required>
                                <option value="">Band auswÃ¤hlen</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="eventTitle">Titel / Anlass <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="text" id="eventTitle" placeholder="z.B. Hochzeit, Firmenfeier..." required>
                        </div>
                        <div class="form-group">
                            <label for="eventDate">Datum und Uhrzeit <span style="color:red;"
                                    title="Pflichtfeld">*</span></label>
                            <input type="datetime-local" id="eventDate" required>
                        </div>
                        <div class="form-group">
                            <label for="eventLocation">ğŸ“ Ort / Adresse</label>
                            <input type="text" id="eventLocation" placeholder="Musterstadt, Hauptstr 1">
                        </div>
                    </div>

                    <div class="form-section-divider"></div>

                    <div class="form-group toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="eventShowExtras">
                            <span class="toggle-slider"></span>
                        </label>
                        <label for="eventShowExtras" class="toggle-label">Weitere Infos (Soundcheck, Technik,
                            Event-Infos)</label>
                    </div>

                    <div id="eventExtrasFields" class="form-optional-section" style="display:none;">
                        <div class="form-group">
                            <label for="eventSoundcheckLocation">ğŸšï¸ Soundcheck Infos</label>
                            <input type="text" id="eventSoundcheckLocation"
                                placeholder="Uhrzeit, konkreter Ort im GebÃ¤ude...">
                        </div>
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label for="eventInfo">â„¹ï¸ Event-Infos</label>
                                <textarea id="eventInfo" rows="3" placeholder="Ablauf, Ansprechpartner..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="eventTechInfo">ğŸ”§ Technik / PA</label>
                                <textarea id="eventTechInfo" rows="3"
                                    placeholder="Was wird benÃ¶tigt? Monitoring?"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-section-divider"></div>

                    <div class="form-group">
                        <label class="section-title">ğŸ‘¥ Beteiligte Bandmitglieder</label>
                        <div id="eventBandMembers" class="checkbox-list members-grid"></div>
                    </div>

                    <div class="form-group toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="eventShowGuests">
                            <span class="toggle-slider"></span>
                        </label>
                        <label for="eventShowGuests" class="toggle-label">GÃ¤ste / Aushilfen dabei?</label>
                    </div>

                    <div id="eventGuestsField" class="form-optional-section" style="display:none;">
                        <label for="eventGuests">ğŸ­ GÃ¤steliste</label>
                        <textarea id="eventGuests" rows="2" placeholder="Name (Instrument/Rolle)"></textarea>
                    </div>

                    <div class="form-section-divider"></div>

                    <div class="form-group setlist-section">
                        <div class="section-header-row">
                            <label class="section-title">ğŸµ Setlist</label>
                            <div class="section-actions">
                                <button type="button" id="copyBandSongsBtn" class="btn btn-secondary btn-sm"
                                    style="display: none;">
                                    ğŸ“‹ Band-Pool
                                </button>
                                <button type="button" id="addEventSongBtn" class="btn btn-secondary btn-sm">
                                    + Neuer Song
                                </button>
                            </div>
                        </div>
                        <div id="eventSongsList" class="compact-song-list"></div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" id="saveEventBtn" class="btn btn-primary">Auftritt speichern</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Song Management Modal -->
        <div id="songModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="song ModalTitle">Song hinzufÃ¼gen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="songForm">
                    <input type="hidden" id="songId">
                    <input type="hidden" id="songEventId">
                    <input type="hidden" id="songBandId">
                    <div class="form-group">
                        <label for="songTitle">Titel</label>
                        <input type="text" id="songTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="songArtist">Interpret</label>
                        <input type="text" id="songArtist" required>
                    </div>
                    <div class="form-group">
                        <label for="songBPM">BPM</label>
                        <input type="number" id="songBPM" min="1" placeholder="z.B. 120">
                    </div>
                    <div class="form-group">
                        <label for="songKey">Tonart</label>
                        <select id="songKey">
                            <option value="">â€” Auswahl â€”</option>
                            <!-- Major keys -->
                            <option value="C">C</option>
                            <option value="C#">C# / Db</option>
                            <option value="D">D</option>
                            <option value="D#">D# / Eb</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="F#">F# / Gb</option>
                            <option value="G">G</option>
                            <option value="G#">G# / Ab</option>
                            <option value="A">A</option>
                            <option value="A#">A# / Bb</option>
                            <option value="B">B</option>
                            <!-- Minor keys -->
                            <option value="Cm">Cm</option>
                            <option value="C#m">C#m / Dbm</option>
                            <option value="Dm">Dm</option>
                            <option value="D#m">D#m / Ebm</option>
                            <option value="Em">Em</option>
                            <option value="Fm">Fm</option>
                            <option value="F#m">F#m / Gbm</option>
                            <option value="Gm">Gm</option>
                            <option value="G#m">G#m / Abm</option>
                            <option value="Am">Am</option>
                            <option value="A#m">A#m / Bbm</option>
                            <option value="Bm">Bm</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="songCcli">Songselect CCLI Nummer (optional)</label>
                        <input type="text" id="songCcli" placeholder="CCLI Nummer">
                    </div>
                    <div class="form-group">
                        <label for="songLeadVocal">Lead Vocal</label>
                        <input type="text" id="songLeadVocal" placeholder="Name des Lead-SÃ¤ngers">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Event Details Modal -->
        <div id="eventDetailsModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="eventDetailsTitle"></h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="eventDetailsContent"></div>
                </div>
            </div>
        </div>

        <!-- Join Band Modal -->
        <div id="joinBandModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Band beitreten</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="joinBandForm">
                    <div class="form-group">
                        <label for="joinBandCode">Band-Beitrittscode</label>
                        <input type="text" id="joinBandCode" maxlength="6" pattern="[A-Za-z0-9]{6}" placeholder="XXXXXX"
                            required style="text-transform: uppercase;">
                        <small style="color: var(--color-text-secondary);">Frag deinen Bandleiter nach dem
                            6-stelligen
                            Code</small>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">Beitreten</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Absence Management Modal -->
        <div id="absenceModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Meine Abwesenheiten</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Create Absence Section -->
                    <div class="section">
                        <h3>Neue Abwesenheit eintragen</h3>
                        <form id="createAbsenceForm">
                            <input type="hidden" id="editAbsenceId">
                            <div class="form-group">
                                <label for="absenceStart">Von (Datum)</label>
                                <input type="date" id="absenceStart" required>
                            </div>
                            <div class="form-group">
                                <label for="absenceEnd">Bis (Datum)</label>
                                <input type="date" id="absenceEnd" required>
                            </div>
                            <div class="form-group">
                                <label for="absenceReason">Grund (optional)</label>
                                <input type="text" id="absenceReason" placeholder="z.B. Urlaub, Krankheit...">
                            </div>
                            <div style="display:flex; gap:0.5rem; align-items:center;">
                                <button type="submit" id="saveAbsenceBtn" class="btn btn-primary">Abwesenheit
                                    hinzufÃ¼gen</button>
                                <button type="button" id="cancelEditAbsenceBtn" class="btn cancel"
                                    style="display:none;">Abbrechen</button>
                            </div>
                        </form>
                    </div>

                    <!-- List Absences Section -->
                    <div class="section">
                        <h3>Meine eingetragenen Abwesenheiten</h3>
                        <div id="absencesList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create News Modal -->
        <div id="createNewsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>News erstellen</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="createNewsForm">
                    <input type="hidden" id="editNewsId">
                    <div class="form-group">
                        <label for="newsTitle">Titel</label>
                        <input type="text" id="newsTitle" required placeholder="z.B. Neue Feature: Abwesenheiten">
                    </div>
                    <div class="form-group">
                        <label for="newsContent">Inhalt</label>
                        <!-- Rich Text Editor Toolbar -->
                        <div class="rte-toolbar">
                            <button type="button" class="rte-button" data-command="bold" title="Fett (Strg+B)">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="rte-button" data-command="italic" title="Kursiv (Strg+I)">
                                <em>I</em>
                            </button>
                            <button type="button" class="rte-button" data-command="underline"
                                title="Unterstrichen (Strg+U)">
                                <u>U</u>
                            </button>
                            <span class="rte-divider"></span>
                            <button type="button" class="rte-button" data-command="formatBlock" data-value="h3"
                                title="Ãœberschrift 3">
                                H3
                            </button>
                            <button type="button" class="rte-button" data-command="formatBlock" data-value="h4"
                                title="Ãœberschrift 4">
                                H4
                            </button>
                            <button type="button" class="rte-button" data-command="formatBlock" data-value="p"
                                title="Normal">
                                P
                            </button>
                            <span class="rte-divider"></span>
                            <button type="button" class="rte-button" data-command="insertUnorderedList"
                                title="AufzÃ¤hlung">
                                â€¢ List
                            </button>
                            <button type="button" class="rte-button" data-command="insertOrderedList"
                                title="Nummerierte Liste">
                                1. List
                            </button>
                            <span class="rte-divider"></span>
                            <button type="button" class="rte-button" id="rteInsertImageBtn" title="Bild einfÃ¼gen">
                                ğŸ–¼ï¸ Bild
                            </button>
                        </div>
                        <!-- Rich Text Editor Content Area -->
                        <div id="newsContent" class="rte-editor" contenteditable="true" role="textbox"
                            aria-label="News content editor"
                            data-placeholder="Beschreibe das Update oder Feature... Du kannst Text formatieren und Bilder einfÃ¼gen.">
                        </div>
                        <!-- Hidden file input for inline images -->
                        <input type="file" id="rteImageInput" accept="image/*" style="display:none;">
                    </div>
                    <div class="form-group">
                        <label for="newsImages">Bilder (optional)</label>
                        <input type="file" id="newsImages" accept="image/*" multiple>
                        <div id="newsImagesPreview"
                            style="display:flex; gap:0.5rem; margin-top:0.5rem; flex-wrap:wrap;">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn cancel">Abbrechen</button>
                        <button type="submit" class="btn btn-primary">VerÃ¶ffentlichen</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- News Detail Modal -->
        <div id="newsDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="newsDetailTitle">News Details</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="newsDetailDate"
                        style="font-size: 0.875rem; color: var(--color-text-light); margin-bottom: var(--spacing-md);">
                    </p>
                    <div id="newsDetailImages"
                        style="display:flex; gap:0.5rem; margin-bottom: var(--spacing-lg); flex-wrap:wrap;"></div>
                    <p id="newsDetailContent" style="color: var(--color-text-secondary); white-space: pre-wrap;">
                    </p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary cancel">SchlieÃŸen</button>
                </div>
            </div>
        </div>

        <!-- Confirm Delete Modal -->
        <div id="confirmDeleteModal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2 id="confirmDeleteTitle">Wirklich lÃ¶schen?</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="confirmDeleteMessage" style="margin: 0; color: var(--color-text-secondary);">
                        MÃ¶chtest du diesen Eintrag wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht
                        werden.
                    </p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel" id="confirmDeleteCancel">Abbrechen</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteConfirm">LÃ¶schen</button>
                </div>
            </div>
        </div>



        <!-- Calendar Event Detail Modal -->
        <div id="calendarEventModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2 id="eventModalTitle">Event Details</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <strong style="color: var(--color-text-secondary);">Titel:</strong>
                            <p id="eventModalSummary" style="margin: 0.25rem 0 0 0;"></p>
                        </div>
                        <div>
                            <strong style="color: var(--color-text-secondary);">Zeit:</strong>
                            <p id="eventModalTime" style="margin: 0.25rem 0 0 0;"></p>
                        </div>
                        <div id="eventModalDescriptionContainer" style="display: none;">
                            <strong style="color: var(--color-text-secondary);">Beschreibung:</strong>
                            <p id="eventModalDescription" style="margin: 0.25rem 0 0 0; white-space: pre-wrap;"></p>
                        </div>
                        <div id="eventModalLocationContainer" style="display: none;">
                            <strong style="color: var(--color-text-secondary);">Ort:</strong>
                            <p id="eventModalLocation" style="margin: 0.25rem 0 0 0;"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Image Preview Modal -->
        <div id="profileImageModal" class="modal">
            <div class="modal-content" style="max-width: 600px; text-align: center;">
                <div class="modal-header">
                    <h2>Profilbild</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <img id="profileImagePreview" src="" alt="Profilbild"
                        style="max-width: 100%; max-height: 70vh; border-radius: 8px;">
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>

    </div> <!-- End of mainApp -->

    <!-- Scripts -->
    <!-- iCal.js library for parsing calendar data -->
    <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>

    <script src="js/supabase.js?v=1.0.1"></script>
    <script src="js/storage.js?v=1.0.1"></script>
    <script src="js/auth.js?v=1.0.1"></script>
    <script src="js/email-service.js?v=1.0.1"></script>
    <script src="js/bands.js?v=1.0.1"></script>
    <script src="js/events.js?v=1.0.1"></script>
    <script src="js/rehearsals.js?v=1.0.1"></script>
    <script src="js/statistics.js?v=1.0.1"></script>
    <script src="js/calendar.js?v=1.0.1"></script>
    <script src="js/personal-calendar.js?v=1.0.1"></script>
    <script src="js/churchtools-api.js?v=1.0.1"></script>
    <script src="js/musikpool.js?v=1.0.1"></script>
    <script src="js/ui.js?v=1.0.1"></script>
    <script src="js/app.js?v=1.0.1"></script>


    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch((error) => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>



    <!-- Capacitor JS (will be injected by Capacitor on iOS, safe to fail in browser) -->
    <script src="capacitor.js" onerror="console.log('Capacitor not available (running in browser)')"></script>
    <!-- Dynamic Stage Effects for "Sound Check" -->
    <div id="stageEffectsContainer" class="stage-lights-overlay">
        <!-- Reaching Stage Beams -->
        <div class="stage-beam"></div>
        <div class="stage-beam"></div>
        <div class="stage-beam"></div>
        <div class="stage-beam"></div>

        <!-- Floating Music Symbols -->
        <div class="floating-notations">
            <span class="music-note">ğŸµ</span>
            <span class="music-note">ğŸ¸</span>
            <span class="music-note">ğŸ¶</span>
            <span class="music-note">ğŸ¼</span>
            <span class="music-note">ğŸ¹</span>
            <span class="music-note">ğŸ¤</span>
            <span class="music-note">ğŸµ</span>
            <span class="music-note">ğŸ¶</span>
        </div>
    </div>
</body>

</html>