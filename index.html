<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Band Planning Tool</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/calendar.css">
    <!-- Supabase JS (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <!-- Login/Registration Modal -->
    <div id="authModal" class="modal active">
        <div class="modal-content auth-modal">
            <h1>üéµ Band Planning Tool</h1>
            <p class="subtitle">Organisiere deine Bandproben effizient</p>

            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Anmelden</button>
                <button class="auth-tab" data-tab="register">Registrieren</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginUsername">Benutzername oder E-Mail</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Passwort</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary">Anmelden</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerCode">Registrierungscode</label>
                    <input type="text" id="registerCode" placeholder="Code eingeben" required>
                    <small style="color: var(--color-text-secondary); font-size: 0.875rem;">Bitte gib den g√ºltigen
                        Registrierungscode ein</small>
                </div>
                <div class="form-group">
                    <label for="registerName">Name</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">E-Mail</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerUsername">Benutzername</label>
                    <input type="text" id="registerUsername" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Passwort</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="registerPasswordConfirm">Passwort best√§tigen</label>
                    <input type="password" id="registerPasswordConfirm" required>
                </div>
                <button type="submit" class="btn btn-primary">Registrieren</button>
            </form>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboardingModal" class="modal">
        <div class="modal-content auth-modal">
            <h1>Willkommen! üéâ</h1>
            <p class="subtitle">Sch√∂n, dass du da bist! Wie m√∂chtest du starten?</p>

            <div class="onboarding-actions" style="display: flex; flex-direction: column; gap: 1rem;">
                <button id="onboardingCreateBandBtn" class="btn btn-primary" style="justify-content: center;">
                    üé∏ Neue Band gr√ºnden
                </button>
                <button id="onboardingJoinBandBtn" class="btn btn-secondary" style="justify-content: center;">
                    üëã Bestehender Band beitreten
                </button>
                <button id="onboardingSkipBtn" class="btn btn-secondary"
                    style="border: none; color: var(--color-text-secondary);">
                    Erstmal nur umschauen
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="logo">üéµ Band Planning</h1>
                <div class="header-actions">
                    <span id="currentUserName" class="user-name">User</span>
                    <button id="absenceBtn" class="btn btn-secondary" style="display: none;">üìÖ Abwesenheiten</button>
                    <button id="settingsBtn" class="btn btn-secondary" style="display: none;">‚öôÔ∏è Settings</button>
                    <button id="logoutBtn" class="btn btn-secondary">
                        <img src="images/logout-logo Kopie.jpg" alt="Abmelden" class="icon-img">
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="app-nav">
            <button class="nav-item active" data-view="dashboard">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button class="nav-item" data-view="bands">
                <span class="nav-icon">üé∏</span>
                <span class="nav-label">Meine Bands</span>
            </button>
            <button class="nav-item" data-view="events" style="display: none;">
                <span class="nav-icon">üé§</span>
                <span class="nav-label">Auftritte</span>
            </button>
            <button class="nav-item" data-view="rehearsals" style="display: none;">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-label">Probetermine</span>
            </button>
            <button class="nav-item" data-view="statistics">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Statistiken</span>
            </button>
            <button class="nav-item" data-view="news">
                <span class="nav-icon">üì∞</span>
                <span class="nav-label">News & Updates</span>
            </button>
            <button class="nav-item" data-view="probeorte">
                <span class="nav-icon">üéôÔ∏è</span>
                <span class="nav-label">Probeorte</span>
            </button>
            <button class="nav-item" data-view="musikpool">
                <span class="nav-icon">üéµ</span>
                <span class="nav-label">Musikpool</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view active">
                <div class="view-header">
                    <h2>Dashboard</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-icon">üé∏</div>
                        <div class="card-content">
                            <h3>Meine Bands</h3>
                            <p class="card-stat" id="bandCount">0</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">üé§</div>
                        <div class="card-content">
                            <h3>N√§chste Auftritte</h3>
                            <p class="card-stat" id="upcomingEvents">0</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">üìÖ</div>
                        <div class="card-content">
                            <h3>Offene Abstimmungen</h3>
                            <p class="card-stat" id="pendingVotes">0</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">‚úÖ</div>
                        <div class="card-content">
                            <h3>Geplante Proben</h3>
                            <p class="card-stat" id="confirmedRehearsals">0</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>N√§chste Termine</h3>
                    <div id="upcomingList" class="rehearsal-list"></div>
                </div>
            </div>

            <!-- Bands View -->
            <div id="bandsView" class="view">
                <div class="view-header">
                    <h2>Meine Bands</h2>
                    <div class="view-controls">
                        <button id="joinBandBtn" class="btn btn-primary btn-bands-join-modal">
                            Band beitreten
                        </button>
                    </div>
                </div>
                <div id="bandsList" class="bands-grid"></div>
            </div>

            <!-- Events View -->
            <div id="eventsView" class="view">
                <div class="view-header">
                    <h2>Auftritte</h2>
                    <div class="view-controls">
                        <select id="eventBandFilter" class="form-select">
                            <option value="">Alle Bands</option>
                        </select>
                        <button id="createEventBtn" class="btn btn-primary">+ Neuer Auftritt</button>
                    </div>
                </div>
                <div id="eventsList" class="events-list"></div>
            </div>

            <!-- Rehearsals View -->
            <div id="rehearsalsView" class="view">
                <div class="view-header">
                    <h2>Probetermine</h2>
                    <div class="view-controls">
                        <select id="bandFilter" class="form-select">
                            <option value="">Alle Bands</option>
                        </select>
                        <button id="createRehearsalBtn" class="btn btn-primary">+ Neuer Probetermin</button>
                    </div>
                </div>
                <div id="rehearsalsList" class="rehearsal-list"></div>
            </div>

            <!-- Statistics View -->
            <div id="statisticsView" class="view">
                <div class="view-header">
                    <h2>Statistiken</h2>
                    <div style="display:flex; gap: 0.5rem; align-items:center;">
                        <select id="statsBandSelect" class="form-select">
                            <option value="">Band ausw√§hlen</option>
                        </select>
                        <select id="statsRehearsalSelect" class="form-select">
                            <option value="">Probetermin ausw√§hlen</option>
                        </select>
                    </div>
                </div>
                <div id="statisticsContent" class="statistics-content">
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <p>W√§hle einen Probetermin aus, um die Statistiken zu sehen</p>
                    </div>
                </div>
            </div>

            <!-- News & Updates View -->
            <div id="newsView" class="view">
                <div class="view-header">
                    <h2>News & Updates</h2>
                    <button id="createNewsBtn" class="btn btn-primary" style="display: none;">+ News erstellen</button>
                </div>
                <div id="newsContainer" class="news-content">
                    <div class="empty-state">
                        <div class="empty-icon">üì∞</div>
                        <p>Noch keine News oder Updates vorhanden.</p>
                        <p>Hier wirst du auf dem laufenden gehalten.</p>
                    </div>
                </div>
            </div>
            <!-- Probeorte View -->
            <div id="probeorteView" class="view">
                <div class="view-header">
                    <h2>Probeorte Kalender</h2>
                </div>
                
                <!-- Submenu for calendar selection -->
                <div class="calendar-submenu">
                    <button class="calendar-tab active" data-calendar="tonstudio">
                        üéôÔ∏è Tonstudio
                    </button>
                    <button class="calendar-tab" data-calendar="festhalle">
                        üèõÔ∏è JMS Festhalle
                    </button>
                    <button class="calendar-tab" data-calendar="ankersaal">
                        ‚öì Ankersaal
                    </button>
                    <button id="refreshCalendarBtn" class="btn btn-secondary" style="margin-left: auto;">
                        üîÑ Aktualisieren
                    </button>
                </div>
                
                <div class="section">
                    <!-- Tonstudio Calendar -->
                    <div id="tonstudioCalendar" class="calendar-container active">
                        <div id="tonstudioEventsContainer" style="min-height: 400px;">
                            <!-- Events will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Festhalle Calendar -->
                    <div id="festhalleCalendar" class="calendar-container">
                        <div id="festhalleEventsContainer" style="min-height: 400px;">
                            <!-- Events will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Ankersaal Calendar -->
                    <div id="ankersaalCalendar" class="calendar-container">
                        <div id="ankersaalEventsContainer" style="min-height: 400px;">
                            <!-- Events will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Musikpool View -->
            <div id="musikpoolView" class="view">
                <div class="view-header">
                    <h2>Musikpool</h2>
                    <button id="refreshMusikpoolBtn" class="btn btn-secondary"
                        style="display: inline-flex; align-items: center; gap: 0.5rem;">
                        üîÑ Aktualisieren
                    </button>
                </div>
                <div class="section">
                    <div id="musikpoolContainer">
                        <!-- Members will be rendered here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button id="settingsTabProfile" class="settings-tab-btn active" data-tab="profile">Profil</button>
                    <button id="settingsTabLocations" class="settings-tab-btn" data-tab="locations">Probeorte</button>
                    <button id="settingsTabBands" class="settings-tab-btn" data-tab="bands">Bandmanagement</button>
                    <button id="settingsTabUsers" class="settings-tab-btn" data-tab="users" style="display: none;">Benutzerverwaltung</button>
                </div>

                <!-- Profile Tab -->
                <div id="profileSettingsTab" class="settings-tab-content active">
                    <div class="section">
                        <h3>Mein Profil bearbeiten</h3>
                        <form id="updateProfileForm">
                            <div class="form-group">
                                <label for="profileUsername">Benutzername</label>
                                <input type="text" id="profileUsername" required>
                            </div>
                            <div class="form-group">
                                <label for="profileEmail">E-Mail</label>
                                <input type="email" id="profileEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="profileInstrument">Instrument</label>
                                <select id="profileInstrument" class="form-select">
                                    <option value="">Kein Instrument</option>
                                    <option value="drums">Schlagzeug (ü•Å)</option>
                                    <option value="bass">Bass (üé∏)</option>
                                    <option value="acoustic_guitar">Akustische Gitarre (üé∏)</option>
                                    <option value="electric_guitar">Elektrische Gitarre (üé∏)</option>
                                    <option value="keyboard">Keyboard (üéπ)</option>
                                    <option value="synth">Synth (üéπ)</option>
                                    <option value="violin">Geige (üéª)</option>
                                    <option value="vocals">Gesang (üé§)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="profilePassword">Neues Passwort (leer lassen f√ºr keine √Ñnderung)</label>
                                <input type="password" id="profilePassword" placeholder="Neues Passwort">
                            </div>
                            <button type="submit" class="btn btn-primary">Speichern</button>
                        </form>
                        <div class="section" style="margin-top: 1rem;">
                            <h3>Darstellung</h3>
                            <div class="form-group" style="display:flex;align-items:center;gap:12px;">
                                <label for="themeToggle" style="margin:0;">Dark Mode</label>
                                <label class="switch">
                                    <input type="checkbox" id="themeToggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <small style="color: var(--color-text-secondary);">Der Dark Mode wird lokal gespeichert.</small>
                        </div>
                    </div>
                </div>

                <!-- Locations Tab -->
                <div id="locationsSettingsTab" class="settings-tab-content">
                    <div class="section">
                        <h3>Neuen Probeort hinzuf√ºgen</h3>
                        <form id="createLocationForm" class="inline-form">
                            <div class="form-group">
                                <label for="newLocationName" class="sr-only">Name</label>
                                <input type="text" id="newLocationName" placeholder="Name (z.B. Proberaum A)" required>
                            </div>
                            <div class="form-group">
                                <label for="newLocationAddress" class="sr-only">Adresse</label>
                                <input type="text" id="newLocationAddress" placeholder="Adresse (Optional)">
                            </div>
                            <div class="form-group">
                                <label for="newLocationLinkedCalendar">Mit Kalender verkn√ºpfen:</label>
                                <select id="newLocationLinkedCalendar" class="form-select">
                                    <option value="">Nicht verkn√ºpft</option>
                                    <option value="tonstudio">üéôÔ∏è Tonstudio</option>
                                    <option value="festhalle">üèõÔ∏è JMS Festhalle</option>
                                    <option value="ankersaal">‚öì Ankersaal</option>
                                </select>
                                <p class="help-text">W√§hle einen Kalender, um bei der Probe-Erstellung die Verf√ºgbarkeit zu pr√ºfen.</p>
                            </div>
                            <button type="submit" class="btn btn-primary">Hinzuf√ºgen</button>
                        </form>
                    </div>
                    <div class="section">
                        <h3>Vorhandene Probeorte</h3>
                        <div id="locationsList" class="locations-list"></div>
                    </div>
                </div>

                <!-- Bands Management Tab -->
                <div id="bandsSettingsTab" class="settings-tab-content">
                    <div class="section">
                        <div>
                            <h3>Alle Bands</h3>
                            <button id="createBandBtn" class="btn btn-primary">+ Neue Band erstellen</button>

                        </div>
                        <div id="allBandsList" class="bands-management-list"></div>
                    </div>
                </div>

                <!-- User Management Tab (Admin Only) -->
                <div id="usersSettingsTab" class="settings-tab-content">
                    <div class="section">
                        <h3>Benutzerverwaltung</h3>
                        <p class="help-text">Verwalte alle registrierten Benutzer</p>
                        <div id="usersList" class="users-list"></div>
                    </div>
                </div>

                <!-- Supabase Settings Tab -->
                <div id="supabaseSettingsTab" class="settings-tab-content">
                    <div class="section">
                        <h3>Supabase Konfiguration</h3>
                        <form id="supabaseSettingsForm">
                            <div class="form-group">
                                <label for="supabaseUrl">Supabase URL</label>
                                <input type="url" id="supabaseUrl" placeholder="https://your-project.supabase.co">
                            </div>
                            <div class="form-group">
                                <label for="supabaseAnonKey">Supabase Anon Key</label>
                                <input type="text" id="supabaseAnonKey" placeholder="ey...">
                            </div>
                            <small style="color: var(--color-text-secondary);">Diese Daten werden lokal gespeichert und f√ºr die Datenbankverbindung genutzt.</small>
                            <div class="modal-actions" style="margin-top: 0.5rem;">
                                <button type="submit" class="btn btn-primary">Speichern</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Band Modal -->
    <div id="createBandModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Neue Band erstellen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createBandForm">
                <div class="form-group">
                    <label for="bandName">Bandname</label>
                    <input type="text" id="bandName" required>
                </div>
                <div class="form-group">
                    <label for="bandDescription">Beschreibung</label>
                    <textarea id="bandDescription" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Band erstellen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Location Modal -->
    <div id="editLocationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Probeort bearbeiten</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="editLocationForm">
                <input type="hidden" id="editLocationId">
                <div class="form-group">
                    <label for="editLocationName">Name</label>
                    <input type="text" id="editLocationName" required>
                </div>
                <div class="form-group">
                    <label for="editLocationAddress">Adresse</label>
                    <input type="text" id="editLocationAddress">
                </div>
                <div class="form-group">
                    <label for="editLocationLinkedCalendar">Mit Kalender verkn√ºpfen:</label>
                    <select id="editLocationLinkedCalendar" class="form-select">
                        <option value="">Nicht verkn√ºpft</option>
                        <option value="tonstudio">üéôÔ∏è Tonstudio</option>
                        <option value="festhalle">üèõÔ∏è JMS Festhalle</option>
                        <option value="ankersaal">‚öì Ankersaal</option>
                    </select>
                    <p class="help-text">W√§hle einen Kalender, um bei der Probe-Erstellung die Verf√ºgbarkeit zu pr√ºfen.</p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Band Details Modal -->
    <div id="bandDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="bandDetailsName"></h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="members">Mitglieder</button>
                    <button class="tab-btn" data-tab="setlist">Setlist</button>
                    <!-- Abwesenheiten-Tab (sichtbar f√ºr Leiter/Co-Leiter) -->
                    <button class="tab-btn" data-tab="absences" id="bandAbsencesTabBtn"
                        style="display: none;">Abwesenheiten</button>
                    <button class="tab-btn" data-tab="settings">Settings</button>
                </div>

                <!-- Members Tab -->
                <div id="membersTab" class="tab-content active">
                    <div class="section">
                        <div class="section-header">
                            <h3>Bandmitglieder</h3>
                            <button id="addMemberBtn" class="btn btn-primary btn-sm">+ Mitglied hinzuf√ºgen</button>
                        </div>
                        <div id="membersList" class="members-list"></div>
                    </div>
                </div>

                <!-- Setlist Tab -->
                <div id="setlistTab" class="tab-content">
                    <div class="section">
                        <div class="section-header">
                            <h3>Songs</h3>
                            <button id="addBandSongBtn" class="btn btn-primary btn-sm">+ Song hinzuf√ºgen</button>
                        </div>
                        <div id="bandSongsList"></div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="tab-content">
                    <div class="section" id="bandSettingsSection">
                        <h3>Band-Einstellungen</h3>
                        <div class="settings-actions">
                            <button id="deleteBandBtn" class="btn btn-danger">Band l√∂schen</button>
                        </div>
                    </div>
                </div>

                <!-- Absences Tab (for leaders/co-leaders) -->
                <div id="absencesTab" class="tab-content">
                    <div class="section">
                        <h3>Abwesenheiten der Mitglieder</h3>
                        <div id="bandAbsencesList">Keine Abwesenheiten vorhanden.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mitglied hinzuf√ºgen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="addMemberForm">
                <div class="form-group">
                    <label for="memberUsername">Benutzername</label>
                    <input type="text" id="memberUsername" required>
                </div>
                <div class="form-group">
                    <label for="memberRole">Rolle</label>
                    <select id="memberRole" required>
                        <option value="member">Mitglied</option>
                        <option value="co-leader">Co-Leiter</option>
                        <option value="leader">Leiter</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Hinzuf√ºgen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Rehearsal Modal -->
    <div id="createRehearsalModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="rehearsalModalTitle">Neuen Probetermin vorschlagen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createRehearsalForm">
                <input type="hidden" id="editRehearsalId">
                <div class="form-group">
                    <label for="rehearsalBand">Band</label>
                    <select id="rehearsalBand" required>
                        <option value="">Band ausw√§hlen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rehearsalTitle">Titel</label>
                    <input type="text" id="rehearsalTitle" required>
                </div>
                <div class="form-group">
                    <label for="rehearsalLocation">Ort (Optional)</label>
                    <select id="rehearsalLocation">
                        <option value="">Kein Ort ausgew√§hlt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rehearsalDescription">Beschreibung</label>
                    <textarea id="rehearsalDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="rehearsalEvent">Zugewiesener Auftritt (Optional)</label>
                    <select id="rehearsalEvent">
                        <option value="">Kein Auftritt ausgew√§hlt</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Terminvorschl√§ge</label>
                    <div id="dateProposals" class="date-proposals">
                        <div class="date-proposal-item">
                            <input type="datetime-local" class="date-input" required>
                            <button type="button" class="btn-icon remove-date" disabled>üóëÔ∏è</button>
                        </div>
                    </div>
                    <button type="button" id="addDateBtn" class="btn btn-secondary btn-sm">+ Weiteren Termin
                        hinzuf√ºgen</button>
                </div>
                <div class="form-group checkbox-group" id="notifyMembersGroup" style="display: none;">
                    <div class="checkbox-item">
                        <input type="checkbox" id="notifyMembersOnUpdate">
                        <label for="notifyMembersOnUpdate">Update-E-Mail an alle Beteiligten senden</label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary" id="saveRehearsalBtn">Vorschlag erstellen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rehearsal Details Modal -->
    <div id="rehearsalDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="rehearsalDetailsTitle"></h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="rehearsalDetailsContent"></div>
            </div>
        </div>
    </div>

    <!-- Confirm Rehearsal Modal -->
    <div id="confirmRehearsalModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Probe best√§tigen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="confirmRehearsalId">
                <input type="hidden" id="confirmDateIndex">

                <div class="section">
                    <h3>Ausgew√§hlter Termin</h3>
                    <p id="selectedDateTime" class="selected-date-display"></p>
                </div>

                <div class="section">
                    <h3>Probeort ausw√§hlen</h3>
                    <select id="confirmRehearsalLocation" class="form-select">
                        <option value="">Kein Ort ausgew√§hlt</option>
                    </select>
                </div>

                <div class="section">
                    <h3>Bandmitglieder benachrichtigen</h3>
                    <p class="help-text">W√§hle aus, welche Bandmitglieder eine Best√§tigungs-E-Mail erhalten sollen:</p>
                    <div id="confirmMembersList" class="confirm-members-list"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="button" id="sendConfirmationBtn" class="btn btn-primary">‚úÖ Probe best√§tigen & E-Mail
                        senden</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div id="createEventModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="eventModalTitle">Neuen Auftritt erstellen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createEventForm">
                <input type="hidden" id="editEventId">
                <div class="form-group">
                    <label for="eventBand">Band</label>
                    <select id="eventBand" required>
                        <option value="">Band ausw√§hlen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="eventTitle">Titel</label>
                    <input type="text" id="eventTitle" required>
                </div>
                <div class="form-group">
                    <label for="eventDate">Datum und Uhrzeit</label>
                    <input type="datetime-local" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label for="eventSoundcheckDate">Soundcheck Datum & Uhrzeit (Optional)</label>
                    <input type="datetime-local" id="eventSoundcheckDate">
                </div>
                <div class="form-group">
                    <label for="eventSoundcheckLocation">Soundcheck Ort (Optional)</label>
                    <input type="text" id="eventSoundcheckLocation" placeholder="Ort des Soundchecks">
                </div>
                <div class="form-group">
                    <label for="eventLocation">Ort (optional)</label>
                    <input type="text" id="eventLocation">
                </div>
                <div class="form-group">
                    <label for="eventInfo">Sonstige Infos zum Event</label>
                    <textarea id="eventInfo" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="eventTechInfo">Infos zur Technik</label>
                    <textarea id="eventTechInfo" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Bandmitglieder</label>
                    <div id="eventBandMembers" class="checkbox-list"></div>
                </div>
                <div class="form-group">
                    <label>G√§steliste (Optional)</label>
                    <textarea id="eventGuests" rows="2" placeholder="Namen, durch Komma getrennt"></textarea>
                </div>
                <div class="form-group">
                    <div class="section-header">
                        <label>Setlist</label>
                        <button type="button" id="addEventSongBtn" class="btn btn-secondary btn-sm">Neuen Song
                            erstellen</button>
                    </div>
                    <div id="eventSongsList"></div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" id="saveEventBtn" class="btn btn-primary">Auftritt erstellen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Song Management Modal -->
    <div id="songModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="song ModalTitle">Song hinzuf√ºgen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="songForm">
                <input type="hidden" id="songId">
                <input type="hidden" id="songEventId">
                <input type="hidden" id="songBandId">
                <div class="form-group">
                    <label for="songTitle">Titel</label>
                    <input type="text" id="songTitle" required>
                </div>
                <div class="form-group">
                    <label for="songArtist">Interpret</label>
                    <input type="text" id="songArtist" required>
                </div>
                <div class="form-group">
                    <label for="songBPM">BPM</label>
                    <input type="number" id="songBPM" min="1" placeholder="z.B. 120">
                </div>
                <div class="form-group">
                    <label for="songKey">Tonart</label>
                    <select id="songKey">
                        <option value="">‚Äî Auswahl ‚Äî</option>
                        <!-- Major keys -->
                        <option value="C">C</option>
                        <option value="C#">C# / Db</option>
                        <option value="D">D</option>
                        <option value="D#">D# / Eb</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F# / Gb</option>
                        <option value="G">G</option>
                        <option value="G#">G# / Ab</option>
                        <option value="A">A</option>
                        <option value="A#">A# / Bb</option>
                        <option value="B">B</option>
                        <!-- Minor keys -->
                        <option value="Cm">Cm</option>
                        <option value="C#m">C#m / Dbm</option>
                        <option value="Dm">Dm</option>
                        <option value="D#m">D#m / Ebm</option>
                        <option value="Em">Em</option>
                        <option value="Fm">Fm</option>
                        <option value="F#m">F#m / Gbm</option>
                        <option value="Gm">Gm</option>
                        <option value="G#m">G#m / Abm</option>
                        <option value="Am">Am</option>
                        <option value="A#m">A#m / Bbm</option>
                        <option value="Bm">Bm</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="songCcli">Songselect CCLI Nummer (optional)</label>
                    <input type="text" id="songCcli" placeholder="CCLI Nummer">
                </div>
                <div class="form-group">
                    <label for="songLeadVocal">Lead Vocal</label>
                    <input type="text" id="songLeadVocal" placeholder="Name des Lead-S√§ngers">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div id="eventDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="eventDetailsTitle"></h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="eventDetailsContent"></div>
            </div>
        </div>
    </div>

    <!-- Join Band Modal -->
    <div id="joinBandModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Band beitreten</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="joinBandForm">
                <div class="form-group">
                    <label for="joinBandCode">Band-Beitrittscode</label>
                    <input type="text" id="joinBandCode" maxlength="6" pattern="[A-Za-z0-9]{6}" placeholder="XXXXXX"
                        required style="text-transform: uppercase;">
                    <small style="color: var(--color-text-secondary);">Frag deinen Bandleiter nach dem 6-stelligen Code</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Beitreten</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Absence Management Modal -->
    <div id="absenceModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Meine Abwesenheiten</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Create Absence Section -->
                <div class="section">
                    <h3>Neue Abwesenheit eintragen</h3>
                    <form id="createAbsenceForm">
                        <input type="hidden" id="editAbsenceId">
                        <div class="form-group">
                            <label for="absenceStart">Von (Datum)</label>
                            <input type="date" id="absenceStart" required>
                        </div>
                        <div class="form-group">
                            <label for="absenceEnd">Bis (Datum)</label>
                            <input type="date" id="absenceEnd" required>
                        </div>
                        <div class="form-group">
                            <label for="absenceReason">Grund (optional)</label>
                            <input type="text" id="absenceReason" placeholder="z.B. Urlaub, Krankheit...">
                        </div>
                        <div style="display:flex; gap:0.5rem; align-items:center;">
                            <button type="submit" id="saveAbsenceBtn" class="btn btn-primary">Abwesenheit
                                hinzuf√ºgen</button>
                            <button type="button" id="cancelEditAbsenceBtn" class="btn cancel"
                                style="display:none;">Abbrechen</button>
                        </div>
                    </form>
                </div>

                <!-- List Absences Section -->
                <div class="section">
                    <h3>Meine eingetragenen Abwesenheiten</h3>
                    <div id="absencesList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create News Modal -->
    <div id="createNewsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>News erstellen</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="createNewsForm">
                <input type="hidden" id="editNewsId">
                <div class="form-group">
                    <label for="newsTitle">Titel</label>
                    <input type="text" id="newsTitle" required placeholder="z.B. Neue Feature: Abwesenheiten">
                </div>
                <div class="form-group">
                    <label for="newsContent">Inhalt</label>
                    <textarea id="newsContent" rows="5" required
                        placeholder="Beschreibe das Update oder Feature..."></textarea>
                </div>
                <div class="form-group">
                    <label for="newsImages">Bilder (optional)</label>
                    <input type="file" id="newsImages" accept="image/*" multiple>
                    <div id="newsImagesPreview" style="display:flex; gap:0.5rem; margin-top:0.5rem; flex-wrap:wrap;">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn cancel">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Ver√∂ffentlichen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Confirm Delete Modal -->
    <div id="confirmDeleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmDeleteTitle">Wirklich l√∂schen?</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmDeleteMessage" style="margin: 0; color: var(--color-text-secondary);">
                    M√∂chtest du diesen Eintrag wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.
                </p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn cancel" id="confirmDeleteCancel">Abbrechen</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteConfirm">L√∂schen</button>
            </div>
        </div>
    </div>

    <!-- Calendar Event Detail Modal -->
    <div id="calendarEventModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="eventModalTitle">Event Details</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div>
                        <strong style="color: var(--color-text-secondary);">Titel:</strong>
                        <p id="eventModalSummary" style="margin: 0.25rem 0 0 0;"></p>
                    </div>
                    <div>
                        <strong style="color: var(--color-text-secondary);">Zeit:</strong>
                        <p id="eventModalTime" style="margin: 0.25rem 0 0 0;"></p>
                    </div>
                    <div id="eventModalLocationContainer" style="display: none;">
                        <strong style="color: var(--color-text-secondary);">Ort:</strong>
                        <p id="eventModalLocation" style="margin: 0.25rem 0 0 0;"></p>
                    </div>
                    <div id="eventModalDescriptionContainer" style="display: none;">
                        <strong style="color: var(--color-text-secondary);">Beschreibung:</strong>
                        <p id="eventModalDescription" style="margin: 0.25rem 0 0 0; white-space: pre-wrap;"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- iCal.js library for parsing calendar data -->
    <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>

    <script src="js/supabase.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/storage-compat.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/email-service.js"></script>
    <script src="js/bands.js"></script>
    <script src="js/events.js"></script>
    <script src="js/rehearsals.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/churchtools-api.js"></script>
    <script src="js/musikpool.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>

</html>